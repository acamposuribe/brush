!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).brush={})}(this,(function(t){"use strict";const e=Math.sqrt(3),i=.5*(e-1),s=(3-e)/6,n=t=>0|Math.floor(t),r=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function o(t=Math.random){const e=function(t){const e=512,i=new Uint8Array(e);for(let t=0;t<e/2;t++)i[t]=t;for(let s=0;s<e/2-1;s++){const e=s+~~(t()*(256-s)),n=i[s];i[s]=i[e],i[e]=n}for(let t=256;t<e;t++)i[t]=i[t-256];return i}(t),o=new Float64Array(e).map((t=>r[t%12*2])),a=new Float64Array(e).map((t=>r[t%12*2+1]));return function(t,r){let c=0,h=0,l=0;const u=(t+r)*i,f=n(t+u),m=n(r+u),p=(f+m)*s,x=t-(f-p),d=r-(m-p);let g,v;x>d?(g=1,v=0):(g=0,v=1);const y=x-g+s,w=d-v+s,_=x-1+2*s,b=d-1+2*s,A=255&f,k=255&m;let z=.5-x*x-d*d;if(z>=0){const t=A+e[k];z*=z,c=z*z*(o[t]*x+a[t]*d)}let M=.5-y*y-w*w;if(M>=0){const t=A+g+e[k+v];M*=M,h=M*M*(o[t]*y+a[t]*w)}let S=.5-_*_-b*b;if(S>=0){const t=A+1+e[k+1];S*=S,l=S*S*(o[t]*_+a[t]*b)}return 70*(c+h+l)}}function a(t,e){let i=new c(t),s=()=>i.next();return s.double=()=>s()+11102230246251565e-32*(2097152*s()|0),s.int32=()=>4294967296*i.next()|0,s.quick=s,s}class c{constructor(t){null==t&&(t=+new Date);let e=4022871197;function i(t){t=String(t);for(let i=0;i<t.length;i++){e+=t.charCodeAt(i);let s=.02519603282416938*e;e=s>>>0,s-=e,s*=e,e=s>>>0,s-=e,e+=4294967296*s}return 2.3283064365386963e-10*(e>>>0)}this.c=1,this.s0=i(" "),this.s1=i(" "),this.s2=i(" "),this.s0-=i(t),this.s0<0&&(this.s0+=1),this.s1-=i(t),this.s1<0&&(this.s1+=1),this.s2-=i(t),this.s2<0&&(this.s2+=1)}next(){let{c:t,s0:e,s1:i,s2:s}=this,n=2091639*e+2.3283064365386963e-10*t;return this.s0=i,this.s1=s,this.s2=n-(this.c=0|n)}copy(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}}Worker.createURL=function(t){const e="function"==typeof t?t.toString():t,i=new Blob(["'use strict';\nself.onmessage ="+e],{type:"text/javascript"});return window.URL.createObjectURL(i)},Worker.create=function(t){return new Worker(Worker.createURL(t))};const h=()=>Worker.create((function(t){let e,i;const s={};function n(){let t=r();const e=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,e),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),{texture:t,fbo:e}}function r(){const t=i.createTexture();return i.bindTexture(i.TEXTURE_2D,t),i.texStorage2D(i.TEXTURE_2D,1,i.RGBA8,e.width,e.height),t}function o(){return self.navigator&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent)}onmessage=async t=>{t.data.canvas?(e=t.data.canvas,function(){i=e.getContext("webgl2");const t=((t,e,i)=>{const s=t.createProgram();for(let[n,r]of[[t.VERTEX_SHADER,e],[t.FRAGMENT_SHADER,i]]){const e=t.createShader(n);t.shaderSource(e,r),t.compileShader(e),t.attachShader(s,e)}return t.linkProgram(s),s})(i,"#version 300 es\n    out vec2 p;void main(){vec3 v=vec3(-1);v[gl_VertexID]=3.;gl_Position=vec4(p=v.xy,0,1);}","#version 300 es\n    precision highp float;uniform vec4 u_addColor;uniform bool u_isErase;uniform float u_flip;uniform bool u_isFBO;uniform sampler2D u_source,u_mask;in vec2 p;out vec4 outColor;float m(vec2 f,float v,float x,float p){return fract(sin(dot(f,vec2(v,x)))*p);}\n    #ifndef SPECTRAL\n    #define SPECTRAL\n    float m(float f){return f<.04045?f/12.92:pow((f+.055)/1.055,2.4);}float x(float f){return f<.0031308?f*12.92:1.055*pow(f,1./2.4)-.055;}vec3 f(vec3 f){return vec3(m(f[0]),m(f[1]),m(f[2]));}vec3 n(vec3 f){return clamp(vec3(x(f[0]),x(f[1]),x(f[2])),0.,1.);}void f(vec3 e,out float m,out float f,out float u,out float v,out float x,out float r,out float z){m=min(e.x,min(e.y,e.z));e-=m;f=min(e.y,e.z);u=min(e.x,e.z);v=min(e.x,e.y);x=min(max(0.,e.x-e.z),max(0.,e.x-e.y));r=min(max(0.,e.y-e.z),max(0.,e.y-e.x));z=min(max(0.,e.z-e.y),max(0.,e.z-e.x));}void f(vec3 v,inout float u[38]){float e,x,o,m,y,z,p;f(v,e,x,o,m,y,z,p);u[0]=max(1e-4,e+x*.96853629+o*.51567122+m*.02055257+y*.03147571+z*.49108579+p*.97901834);u[1]=max(1e-4,e+x*.96855103+o*.5401552+m*.02059936+y*.03146636+z*.46944057+p*.97901649);u[2]=max(1e-4,e+x*.96859338+o*.62645502+m*.02062723+y*.03140624+z*.4016578+p*.97901118);u[3]=max(1e-4,e+x*.96877345+o*.75595012+m*.02073387+y*.03119611+z*.2449042+p*.97892146);u[4]=max(1e-4,e+x*.96942204+o*.92826996+m*.02114202+y*.03053888+z*.0682688+p*.97858555);u[5]=max(1e-4,e+x*.97143709+o*.97223624+m*.02233154+y*.02856855+z*.02732883+p*.97743705);u[6]=max(1e-4,e+x*.97541862+o*.98616174+m*.02556857+y*.02459485+z*.013606+p*.97428075);u[7]=max(1e-4,e+x*.98074186+o*.98955255+m*.03330189+y*.0192952+z*.01000187+p*.96663223);u[8]=max(1e-4,e+x*.98580992+o*.98676237+m*.05185294+y*.01423112+z*.01284127+p*.94822893);u[9]=max(1e-4,e+x*.98971194+o*.97312575+m*.10087639+y*.01033111+z*.02636635+p*.89937713);u[10]=max(1e-4,e+x*.99238027+o*.91944277+m*.24000413+y*.00765876+z*.07058713+p*.76070164);u[11]=max(1e-4,e+x*.99409844+o*.32564851+m*.53589066+y*.00593693+z*.70421692+p*.4642044);u[12]=max(1e-4,e+x*.995172+o*.13820628+m*.79874659+y*.00485616+z*.85473994+p*.20123039);u[13]=max(1e-4,e+x*.99576545+o*.05015143+m*.91186529+y*.00426186+z*.95081565+p*.08808402);u[14]=max(1e-4,e+x*.99593552+o*.02912336+m*.95399623+y*.00409039+z*.9717037+p*.04592894);u[15]=max(1e-4,e+x*.99564041+o*.02421691+m*.97137099+y*.00438375+z*.97651888+p*.02860373);u[16]=max(1e-4,e+x*.99464769+o*.02660696+m*.97939505+y*.00537525+z*.97429245+p*.02060067);u[17]=max(1e-4,e+x*.99229579+o*.03407586+m*.98345207+y*.00772962+z*.97012917+p*.01656701);u[18]=max(1e-4,e+x*.98638762+o*.04835936+m*.98553736+y*.0136612+z*.9425863+p*.01451549);u[19]=max(1e-4,e+x*.96829712+o*.0001172+m*.98648905+y*.03181352+z*.99989207+p*.01357964);u[20]=max(1e-4,e+x*.89228016+o*8.554e-5+m*.98674535+y*.10791525+z*.99989891+p*.01331243);u[21]=max(1e-4,e+x*.53740239+o*.85267882+m*.98657555+y*.46249516+z*.13823139+p*.01347661);u[22]=max(1e-4,e+x*.15360445+o*.93188793+m*.98611877+y*.84604333+z*.06968113+p*.01387181);u[23]=max(1e-4,e+x*.05705719+o*.94810268+m*.98559942+y*.94275572+z*.05628787+p*.01435472);u[24]=max(1e-4,e+x*.03126539+o*.94200977+m*.98507063+y*.96860996+z*.06111561+p*.01479836);u[25]=max(1e-4,e+x*.02205445+o*.91478045+m*.98460039+y*.97783966+z*.08987709+p*.0151525);u[26]=max(1e-4,e+x*.01802271+o*.87065445+m*.98425301+y*.98187757+z*.13656016+p*.01540513);u[27]=max(1e-4,e+x*.0161346+o*.78827548+m*.98403909+y*.98377315+z*.22169624+p*.01557233);u[28]=max(1e-4,e+x*.01520947+o*.65738359+m*.98388535+y*.98470202+z*.32176956+p*.0156571);u[29]=max(1e-4,e+x*.01475977+o*.59909403+m*.98376116+y*.98515481+z*.36157329+p*.01571025);u[30]=max(1e-4,e+x*.01454263+o*.56817268+m*.98368246+y*.98537114+z*.4836192+p*.01571916);u[31]=max(1e-4,e+x*.01444459+o*.54031997+m*.98365023+y*.98546685+z*.46488579+p*.01572133);u[32]=max(1e-4,e+x*.01439897+o*.52110241+m*.98361309+y*.98550011+z*.47440306+p*.01572502);u[33]=max(1e-4,e+x*.0143762+o*.51041094+m*.98357259+y*.98551031+z*.4857699+p*.01571717);u[34]=max(1e-4,e+x*.01436343+o*.50526577+m*.98353856+y*.98550741+z*.49267971+p*.01571905);u[35]=max(1e-4,e+x*.01435687+o*.5025508+m*.98351247+y*.98551323+z*.49625685+p*.01571059);u[36]=max(1e-4,e+x*.0143537+o*.50126452+m*.98350101+y*.98551563+z*.49807754+p*.01569728);u[37]=max(1e-4,e+x*.01435408+o*.50083021+m*.98350852+y*.98551547+z*.49889859+p*.0157002);}vec3 w(vec3 e){mat3 u;u[0]=vec3(3.24306333,-1.53837619,-.49893282);u[1]=vec3(-.96896309,1.87542451,.04154303);u[2]=vec3(.05568392,-.20417438,1.05799454);float f=dot(u[0],e),x=dot(u[1],e),o=dot(u[2],e);return n(vec3(f,x,o));}vec3 v(float u[38]){vec3 e=vec3(0);e+=u[0]*vec3(6.469e-5,1.84e-6,.00030502);e+=u[1]*vec3(.00021941,6.21e-6,.00103681);e+=u[2]*vec3(.00112057,3.101e-5,.00531314);e+=u[3]*vec3(.00376661,.00010475,.01795439);e+=u[4]*vec3(.01188055,.00035364,.05707758);e+=u[5]*vec3(.02328644,.00095147,.11365162);e+=u[6]*vec3(.03455942,.00228226,.17335873);e+=u[7]*vec3(.03722379,.00420733,.19620658);e+=u[8]*vec3(.03241838,.0066888,.18608237);e+=u[9]*vec3(.02123321,.0098884,.13995048);e+=u[10]*vec3(.01049099,.01524945,.08917453);e+=u[11]*vec3(.00329584,.02141831,.04789621);e+=u[12]*vec3(.00050704,.03342293,.02814563);e+=u[13]*vec3(.00094867,.05131001,.01613766);e+=u[14]*vec3(.00627372,.07040208,.0077591);e+=u[15]*vec3(.01686462,.08783871,.00429615);e+=u[16]*vec3(.02868965,.09424905,.00200551);e+=u[17]*vec3(.04267481,.09795667,.00086147);e+=u[18]*vec3(.05625475,.09415219,.00036904);e+=u[19]*vec3(.0694704,.08678102,.00019143);e+=u[20]*vec3(.08305315,.07885653,.00014956);e+=u[21]*vec3(.0861261,.0635267,9.231e-5);e+=u[22]*vec3(.09046614,.05374142,6.813e-5);e+=u[23]*vec3(.08500387,.04264606,2.883e-5);e+=u[24]*vec3(.07090667,.03161735,1.577e-5);e+=u[25]*vec3(.05062889,.02088521,3.94e-6);e+=u[26]*vec3(.03547396,.01386011,1.58e-6);e+=u[27]*vec3(.02146821,.00810264,0);e+=u[28]*vec3(.01251646,.0046301,0);e+=u[29]*vec3(.00680458,.00249138,0);e+=u[30]*vec3(.00346457,.0012593,0);e+=u[31]*vec3(.00149761,.00054165,0);e+=u[32]*vec3(.0007697,.00027795,0);e+=u[33]*vec3(.00040737,.00014711,0);e+=u[34]*vec3(.00016901,6.103e-5,0);e+=u[35]*vec3(9.522e-5,3.439e-5,0);e+=u[36]*vec3(4.903e-5,1.771e-5,0);e+=u[37]*vec3(2e-5,7.22e-6,0);return e;}float f(float x,float m,float f){float z=m*pow(f,2.);return z/(x*pow(1.-f,2.)+z);}vec3 m(vec3 x,vec3 e,float o){vec3 u=f(x),m=f(e);float p[38],z[38];f(u,p);f(m,z);float y=v(p)[1],r=v(z)[1];o=f(y,r,o);float i[38];for(int S=0;S<38;S++){float b=(1.-o)*(pow(1.-p[S],2.)/(2.*p[S]))+o*(pow(1.-z[S],2.)/(2.*z[S]));i[S]=1.+b-sqrt(pow(b,2.)+2.*b);}return w(v(i));}\n    #endif\n    void main(){vec2 e=.5*vec2(p.x,u_flip*p.y)+.5;vec4 u=texture(u_source,e);if(u_isFBO)outColor=u;else{vec4 f=texture(u_mask,e);if(f.x>0.){vec2 o=vec2(12.9898,78.233),x=vec2(7.9898,58.233),r=vec2(17.9898,3.233);float v=m(e,o.x,o.y,43358.5453)*2.-1.,y=m(e,x.x,x.y,43213.5453)*2.-1.,z=m(e,r.x,r.y,33358.5453)*2.-1.;vec4 i=vec4(u_addColor.xyz,1);if(f.w>.7&&!u_isErase){float b=.5*(f.w-.7);i=i*(1.-b)-vec4(.5)*b;}vec3 b=m(u.xyz,i.xyz,f.w);outColor=vec4(b+.01*vec3(v,y,z),1);}else outColor=u;}}");let o=["u_flip","u_addColor","u_isErase","u_isFBO","u_source","u_mask","u_isImage"];for(let e of o)s[e]=i.getUniformLocation(t,e);i.useProgram(t),s.mask=r(),s.source=n(),s.target=n(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,s.source.texture),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,s.mask),i.uniform1i(s.u_source,0),i.uniform1i(s.u_mask,1)}()):t.data.isBG?(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,s.source.fbo),i.clearColor(...t.data.color),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):t.data.mask&&function(t){let n;if(o()){const e=new OffscreenCanvas(t.mask.width,t.mask.height).getContext("2d");e.drawImage(t.mask,0,0),n=e.getImageData(0,0,t.mask.width,t.mask.height)}i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,o()?n:t.mask),t.mask.close(),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,s.target.fbo),i.uniform1f(s.u_flip,1),i.uniform1i(s.u_isFBO,!1),i.uniform1i(s.u_isImage,!!t.isImage),t.isImage||(i.uniform1i(s.u_isImage,!1),i.uniform4f(s.u_addColor,...t.addColor),i.uniform1i(s.u_isErase,!!t.isErase)),i.drawArrays(i.TRIANGLES,0,3),i.bindFramebuffer(i.READ_FRAMEBUFFER,s.target.fbo),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,s.source.fbo),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[i.COLOR_ATTACHMENT0]),t.isLast&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.uniform1i(s.u_isImage,!1),i.uniform1i(s.u_isFBO,!0),i.uniform1f(s.u_flip,-1),i.drawArrays(i.TRIANGLES,0,3))}(t.data)}})),l={};let u,f,m,p,x,d=!1;function g(t,e){u=t,l[u]||(l[u]={},l[u].canvas=e),f=l[u].canvas.width,m=l[u].canvas.height,d||(d=!0,X.create()),I.load()}function v(){d||g()}function y(t=!0){x=t}HTMLCanvasElement.prototype.transferControlToOffscreen||y();let w=a(Math.random());let _=a(Math.random());t.noise=o(_);const b={random(t=0,e=1){return Array.isArray(t)?t[~~(w()*t.length)]:1===arguments.length?w()*t:b.rr(...arguments)},rr:(t=0,e=1)=>t+w()*(e-t),randInt:(t,e)=>~~b.rr(t,e),gaussian(t=0,e=1){const i=1-w(),s=w();return Math.sqrt(-2*Math.log(i))*this.cos(360*s)*e+t},pseudoGaussian:(t=0,e=1)=>t-2*e+(w()+w()+w())/3*e*4,weightedRand(t){let e,i,s=[];for(e in t)for(i=0;i<10*t[e];i++)s.push(e);let n=s[Math.floor(w()*s.length)];return isNaN(n)?n:parseInt(n)},map(t,e,i,s,n,r=!1){let o=s+(t-e)/(i-e)*(n-s);return r?s<n?this.constrain(o,s,n):this.constrain(o,n,s):o},constrain:(t,e,i)=>Math.max(Math.min(t,i),e),nAngle:t=>(t%=360)<0?t+360:t,cos(t){return this.c[~~(4*this.nAngle(t))]},sin(t){return this.s[~~(4*this.nAngle(t))]},isPrecalculationDone:!1,preCalculation(){if(this.isPrecalculationDone)return;const t=1440,e=2*Math.PI/t;this.c=new Float32Array(t),this.s=new Float32Array(t);for(let i=0;i<t;i++){const t=i*e;b.c[i]=Math.cos(t),b.s[i]=Math.sin(t)}this.isPrecalculationDone=!0},isNumber:t=>!isNaN(t),toDegrees:t=>{let e=180*t/Math.PI%360;return e<0?e+360:e},dist:(t,e,i,s)=>Math.sqrt((i-t)*(i-t)+(s-e)*(s-e)),calcAngle:(t,e,i,s)=>b.toDegrees(Math.atan2(-(s-e),i-t))};b.preCalculation();const A=b.random,k=b.weightedRand;function z(t,e,i,s,n=!1){let r=t.x,o=t.y,a=e.x,c=e.y,h=i.x,l=i.y,u=s.x,f=s.y;if(r===a&&o===c||h===u&&l===f)return!1;let m=a-r,p=c-o,x=u-h,d=f-l,g=d*m-x*p;if(0===g)return!1;let v=(x*(o-l)-d*(r-h))/g,y=(m*(o-l)-p*(r-h))/g;return!(!n&&(y<0||y>1))&&{x:r+v*m,y:o+v*p}}function M(t,e,i,s,n){let r=b.cos(n),o=b.sin(n);return{x:r*(i-t)+o*(s-e)+t,y:r*(s-e)-o*(i-t)+e}}const S={field:{},stroke:{},hatch:{},fill:{}};function T(t){return t=new C(t),x?`rgb(${t.r} ${t.g} ${t.b} / `:"rgb(255 0 0 / "}let E=document.createElement("canvas");E.width=1,E.height=1;let R=E.getContext("2d");class C{constructor(t,e,i){if(!this.g&&isNaN(t)){this.hex=this.standardize(t);let e=this.hexToRgb(this.hex);this.r=e.r,this.g=e.g,this.b=e.b}else this.r=t,this.g=e||t,this.b=i||t,this.hex=this.rgbToHex(this.r,this.g,this.b);this.gl=[this.r/255,this.g/255,this.b/255,1]}rgbToHex(t,e,i){return"#"+(1<<24|t<<16|e<<8|i).toString(16).slice(1)}hexToRgb(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,s){return e+e+i+i+s+s}));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}standardize(t){return R.fillStyle=t,R.fillStyle}}const I={loaded:!1,isBlending:!1,currentColor:new C("white").gl,load(){if(x){if(!l[_r].worker){let t=l[_r];t.ctx=t.canvas.getContext("2d"),t.ctx.lineWidth=0,t.worker=!0}this.mask=!1,this.worker=l[_r].worker,this.ctx=l[_r].ctx}else{if(!l[u].worker){let t=l[u];t.mask=new OffscreenCanvas(f,m),t.ctx=t.mask.getContext("2d"),t.ctx.lineWidth=0,t.offscreen=l[u].canvas.transferControlToOffscreen(),t.worker=h(),t.worker.postMessage("init"),t.worker.postMessage({canvas:t.offscreen},[t.offscreen])}this.mask=l[u].mask,this.ctx=l[u].ctx,this.worker=l[u].worker}},blend(t=!1,e=!1,i=!1){if(x)return;this.isBlending||t&&(this.currentColor=t.gl,this.isBlending=!0);let s,n=t?t.gl:this.currentColor;if(s=!(!e&&!i)||n.toString()!==this.currentColor.toString(),s){let s=i||this.mask.transferToImageBitmap();this.worker.postMessage({addColor:this.currentColor,mask:s,isLast:e,isErase:I.isErase,isImage:!!i},[s]),this.isErase=!1,e||(this.currentColor=t.gl),e&&(this.isBlending=!1)}}};function F(){I.blend(!1,!0)}let P=new C("white");const B={x:0,y:0};function D(t){I.ctx.scale(t)}function U(t,e){v(),X.list.set(t,{gen:e}),X.current=t,X.refresh()}const X={list:new Map,step_length:()=>Math.min(f,m)/1e3,create(){this.R=.01*f,this.left_x=-.5*f,this.top_y=-.5*m,this.num_columns=Math.round(2*f/this.R),this.num_rows=Math.round(2*m/this.R),this.addStandard()},flow_field(){return this.list.get(this.current).field},refresh(t=0){this.list.get(this.current).field=this.list.get(this.current).gen(t,this.genField())},genField(){let t=new Array(this.num_columns);for(let e=0;e<this.num_columns;e++)t[e]=new Float32Array(this.num_rows);return t},addStandard(){U("curved",(function(e,i){let s=b.randInt(-20,-10);b.randInt(0,100)%2==0&&(s*=-1);for(let n=0;n<X.num_columns;n++)for(let r=0;r<X.num_rows;r++){let o=t.noise(.01*n+.03*e,.01*r+.03*e),a=b.map(o,0,1,-s,s);i[n][r]=a}return i})),U("handwriting",(function(e,i){let s=b.rr(.2,.8),n=b.randInt(5,10);for(let r=0;r<X.num_columns;r++)for(let o=0;o<X.num_rows;o++){let a=b.randInt(15,25),c=n*b.sin(s*o*r+a),h=t.noise(.1*r+e,.1*o+e);i[r][o]=.5*c*b.cos(e)+h*c}return i})),U("seabed",(function(t,e){let i=b.rr(.4,.8),s=b.randInt(18,26);for(let n=0;n<X.num_columns;n++)for(let r=0;r<X.num_rows;r++){let o=b.randInt(15,20),a=s*b.sin(i*r*n+o);e[n][r]=1.1*a*b.cos(t)}return e}))}};class O{constructor(t,e){this.update(t,e),this.plotted=0}update(t,e){this.x=t,this.y=e,X.isActive&&(this.x_offset=this.x+B.x-X.left_x,this.y_offset=this.y+B.y-X.top_y,this.column_index=Math.round(this.x_offset/X.R),this.row_index=Math.round(this.y_offset/X.R))}reset(){this.plotted=0}isIn(){return X.isActive?this.column_index>=0&&this.row_index>=0&&this.column_index<X.num_columns&&this.row_index<X.num_rows:this.isInCanvas()}isInCanvas(){let t=f,e=m,i=this.x+B.x,s=this.y+B.y;return i>=-.3*t&&i<=1.3*t&&s>=-.3*e&&s<=1.3*e}angle(){return this.isIn()&&X.isActive?X.flow_field()[this.column_index][this.row_index]:0}moveTo(t,e,i=Y.spacing(),s=!0){if(this.isIn()){let n,r;s||(n=b.cos(-e),r=b.sin(-e));for(let o=0;o<t/i;o++){if(s){let t=this.angle();n=b.cos(t-e),r=b.sin(t-e)}let t=i*n,o=i*r;this.plotted+=i,this.update(this.x+t,this.y+o)}}else this.plotted+=i}plotTo(t,e,i,s){if(this.isIn()){const n=1/s;for(let s=0;s<e/i;s++){let e=this.angle(),s=t.angle(this.plotted),r=i*b.cos(e-s),o=i*b.sin(e-s);this.plotted+=i*n,this.update(this.x+r,this.y+o)}}else this.plotted+=i/D}}function L(t){for(let e of xt){let i=Y.list.get(e[0]).param;i.weight*=t,i.vibration*=t,i.spacing*=t}}const N=2*Math.PI;const Y={isActive:!0,list:new Map,c:new C("black"),w:1,cr:null,name:"HB",spacing(){return this.p=this.list.get(this.name).param,"default"===this.p.type||"spray"===this.p.type?this.p.spacing/this.w:this.p.spacing},initializeDrawingState(t,e,i,s,n){this.position=new O(t,e),this.length=i,this.flow=s,this.plot=n,n&&n.calcIndex(0)},draw(t,e){e||(this.dir=t),this.saveState();const i=this.spacing(),s=e?Math.round(this.length*t/i):Math.round(this.length/i);for(let n=0;n<s;n++)this.tip(),e?this.position.plotTo(this.plot,i,i,t):this.position.moveTo(i,t,i,this.flow);this.restoreState()},saveState(){this.p=this.list.get(this.name).param,this.a="custom"!==this.p.pressure.type?b.rr(-1,1):0,this.b="custom"!==this.p.pressure.type?b.rr(1,1.5):0,this.cp="custom"!==this.p.pressure.type?b.rr(3,3.5):b.rr(-.2,.2);const[t,e]=this.p.pressure.min_max;this.min=t,this.max=e,I.blend(this.c),I.ctx.save(),this.markerTip(),this.alpha=this.calculateAlpha(),this.applyColor(this.alpha),I.ctx.beginPath()},restoreState(){I.ctx.fill(),this.markerTip(),I.ctx.restore()},tip(t=!1){let e=t||this.calculatePressure();if(this.isInsideClippingArea())switch(this.p.type){case"spray":this.drawSpray(e);break;case"marker":this.drawMarker(e);break;case"custom":case"image":this.drawCustomOrImage(e,this.alpha);break;default:this.drawDefault(e)}},calculatePressure(){return this.plot?this.simPressure()*this.plot.pressure(this.position.plotted):this.simPressure()},simPressure(){return"custom"===this.p.pressure.type?b.map(this.p.pressure.curve(this.position.plotted/this.length)+this.cp,0,1,this.min,this.max,!0):this.gauss()},gauss(t=.5+Y.p.pressure.curve[0]*Y.a,e=1-Y.p.pressure.curve[1]*Y.b,i=Y.cp,s=Y.min,n=Y.max){return b.map(1/(1+Math.pow(Math.abs((this.position.plotted-t*this.length)/(e*this.length/2)),2*i)),0,1,s,n)},calculateAlpha(){return"default"!==this.p.type&&"spray"!==this.p.type?this.p.opacity/this.w:this.p.opacity},applyColor(t){I.ctx.fillStyle=T(this.c)+t+"%)"},isInsideClippingArea(){if(Y.cr)return this.position.x>=Y.cr[0]&&this.position.x<=Y.cr[2]&&this.position.y>=Y.cr[1]&&this.position.y<=Y.cr[3];{let t=f,e=m,i=.05*f,s=this.position.x+B.x,n=this.position.y+B.y;return s>=-i&&s<=t+i&&n>=-i&&n<=e+i}},rect(t,e,i){i/=1.2,I.ctx.rect(t-i/2,e-i/2,i,i)},circle(t,e,i){let s=i/2;I.ctx.moveTo(t+s,e),I.ctx.arc(t,e,s,0,N)},drawSpray(t){let e=this.w*this.p.vibration*t+this.w*b.gaussian()*this.p.vibration/3,i=this.p.weight*b.rr(.9,1.1);const s=this.p.quality/t;for(let t=0;t<s;t++){let t=b.rr(.9,1.1),s=t*e*b.rr(-1,1),n=b.rr(-1,1),r=Math.pow(t*e,2),o=Math.sqrt(r-Math.pow(s,2));this.rect(this.position.x+s,this.position.y+n*o,i)}},drawMarker(t,e=!0){let i=e?this.w*this.p.vibration:0,s=e?i*b.rr(-1,1):0,n=e?i*b.rr(-1,1):0;this.circle(this.position.x+s,this.position.y+n,this.w*this.p.weight*t)},drawCustomOrImage(t,e,i=!0){I.ctx.save();let s=i?this.w*this.p.vibration:0,n=i?s*b.rr(-1,1):0,r=i?s*b.rr(-1,1):0;I.ctx.translate(this.position.x+n,this.position.y+r),this.adjustSizeAndRotation(this.w*t,e),this.p.tip(I.ctx),I.ctx.restore()},drawDefault(t){let e=this.w*this.p.vibration*(this.p.definition+(1-this.p.definition)*b.gaussian()*this.gauss(.5,.9,5,.2,1.2)/t);b.rr(0,this.p.quality*t)>.4&&this.rect(this.position.x+.7*e*b.rr(-1,1),this.position.y+e*b.rr(-1,1),t*this.p.weight*b.rr(.85,1.15))},adjustSizeAndRotation(t,e){if(I.ctx.scale(t,t),"image"===this.p.type&&(this.p.blend?this.mask.tint(255,0,0,e/2):this.mask.tint(this.mask.red(this.c),this.mask.green(this.c),this.mask.blue(this.c),e)),"random"===this.p.rotate)I.ctx.rotate(b.randInt(0,N));else if("natural"===this.p.rotate){let t=(this.plot?-this.plot.angle(this.position.plotted):-this.dir)+(this.flow?this.position.angle():0);I.ctx.rotate(t*Math.PI/180)}},markerTip(){if(this.isInsideClippingArea()){let t=this.calculatePressure(),e=this.calculateAlpha(t);if(I.ctx.fillStyle=T(this.c)+e/3+"%)","marker"===Y.p.type)for(let e=1;e<5;e++)I.ctx.beginPath(),this.drawMarker(t*e/5,!1),I.ctx.fill();else if("custom"===Y.p.type||"image"===Y.p.type)for(let i=1;i<5;i++)I.ctx.beginPath(),this.drawCustomOrImage(t*i/5,e,!1),I.ctx.fill()}}};function W(t,e){const i="marker"===e.type||"custom"===e.type||"image"===e.type;i||"spray"===e.type||(e.type="default"),"image"===e.type&&(j.add(e.image.src),e.tip=()=>Y.mask.image(j.tips.get(Y.p.image.src),-Y.p.weight/2,-Y.p.weight/2,Y.p.weight,Y.p.weight)),e.blend=!!(i&&!1!==e.blend||e.blend),Y.list.set(t,{param:e,colors:[],buffers:[]})}function H(t,e,i=1){q(t),Y.c=new C(e),Y.w=i,Y.isActive=!0}function q(t){Y.name=t}function G(t,e,i,s){v();let n=b.dist(t,e,i,s);if(0==n)return;Y.initializeDrawingState(t,e,n,!0,!1);let r=b.calcAngle(t,e,i,s);Y.draw(r,!1)}function $(t,e,i,s){v(),Y.initializeDrawingState(e,i,t.length,!0,t),Y.draw(s,!0)}const j={tips:new Map,add(t){this.tips.set(t,!1)},imageToWhite(t){t.loadPixels();for(let e=0;e<4*t.width*t.height;e+=4){let i=(t.pixels[e]+t.pixels[e+1]+t.pixels[e+2])/3;t.pixels[e]=t.pixels[e+1]=t.pixels[e+2]=255,t.pixels[e+3]=255-i}t.updatePixels()},load(){for(let t of this.tips.keys()){let e=(_isInstanced?_inst:window.self).loadImage(t,(()=>j.imageToWhite(e)));this.tips.set(t,e)}}};function V(t=5,e=45,i={rand:!1,continuous:!1,gradient:!1}){K.isActive=!0,K.hatchingParams=[t,e,i]}function J(t){if(t._boundingBox)return t._boundingBox;let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let r=0;r<t.a.length;r++){const[o,a]=t.a[r];o<e&&(e=o),o>s&&(s=o),a<i&&(i=a),a>n&&(n=a)}return t._boundingBox={minX:e,minY:i,maxX:s,maxY:n},t._boundingBox}const K={isActive:!1,hatchingParams:[5,45,{}],hatchingBrush:!1,hatch(t){let e=K.hatchingParams[0],i=K.hatchingParams[1],s=K.hatchingParams[2],n=Y.c.hex,r=Y.name,o=Y.w,a=Y.isActive;K.hatchingBrush&&H(K.hatchingBrush[0],K.hatchingBrush[1],K.hatchingBrush[2]),i=b.toDegrees(i)%180,Array.isArray(t)||(t=[t]);const c=function(t){let e={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(let i of t){const t=J(i);e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}return e}(t);let h=new Z([[c.minX,c.minY],[c.maxX,c.minY],[c.maxX,c.maxY],[c.minX,c.maxY]]),l=i<=90&&i>=0?c.minY:c.maxY,u=s.gradient?b.map(s.gradient,0,1,1,1.1,!0):1,f=[],m=0,p=e,x=t=>({point1:{x:c.minX+p*t*b.cos(90-i),y:l+p*t*b.sin(90-i)},point2:{x:c.minX+p*t*b.cos(90-i)+b.cos(-i),y:l+p*t*b.sin(90-i)+b.sin(-i)}});for(;h.intersect(x(m)).length>0;){let e=[];for(let i of t)e.push(i.intersect(x(m)));f[m]=e.flat().sort(((t,e)=>t.x===e.x?t.y-e.y:t.x-e.x)),p*=u,m++}let d=[];for(let t of f)void 0!==t[0]&&d.push(t);let g=s.rand?s.rand:0;for(let t=0;t<d.length;t++){let i=d[t],n=t>0&&s.continuous;for(let s=0;s<i.length-1;s+=2)0!==g&&(i[s].x+=g*e*b.rr(-10,10),i[s].y+=g*e*b.rr(-10,10),i[s+1].x+=g*e*b.rr(-10,10),i[s+1].y+=g*e*b.rr(-10,10)),G(i[s].x,i[s].y,i[s+1].x,i[s+1].y),n&&G(d[t-1][1].x,d[t-1][1].y,i[s].x,i[s].y)}H(r,n,o),Y.isActive=a}},Q=K.hatch;class Z{constructor(t,e=!1){this.a=t,this.vertices=t.map((t=>({x:t[0],y:t[1]}))),e&&(this.vertices=t),this.sides=this.vertices.map(((t,e,i)=>[t,i[(e+1)%i.length]]))}intersect(t){let e=`${t.point1.x},${t.point1.y}-${t.point2.x},${t.point2.y}`;if(this._intersectionCache&&this._intersectionCache[e])return this._intersectionCache[e];let i=[];for(let e of this.sides){let s=z(t.point1,t.point2,e[0],e[1]);!1!==s&&i.push(s)}return this._intersectionCache||(this._intersectionCache={}),this._intersectionCache[e]=i,i}draw(t=!1,e,i){let s=Y.isActive;if(t&&H(t,e,i),Y.isActive){v();for(let t of this.sides)G(t[0].x,t[0].y,t[1].x,t[1].y)}Y.isActive=s}fill(t=!1,e,i,s,n,r){let o=ft.isActive;t&&(ht(t,e),lt(i,r),ut(s,n)),ft.isActive&&(v(),ft.fill(this)),ft.isActive=o}hatch(t=!1,e,i){let s=K.isActive;t&&V(t,e,i),K.isActive&&(v(),K.hatch(this)),K.isActive=s}erase(t=!1,e=ct.a){(ct.isActive||t)&&(t=t?new C(t):ct.c,I.blend(t),I.isErase=!0,I.ctx.save(),I.ctx.fillStyle=T(t)+e+"%)",tt(this.vertices),I.ctx.fill(),I.ctx.restore())}show(){this.fill(),this.hatch(),this.draw(),this.erase()}}function tt(t){I.ctx.beginPath();for(let e=0;e<t.length;e++){let i=t[e];0==e?I.ctx.moveTo(i.x,i.y):I.ctx.lineTo(i.x,i.y)}}class et{constructor(t){this.segments=[],this.angles=[],this.pres=[],this.type=t,this.dir=0,this.calcIndex(0),this.pol=!1}addSegment(t=0,e=0,i=1,s=!1){this.angles.length>0&&this.angles.splice(-1),t=s?(t%360+360)%360:b.toDegrees(t),this.angles.push(t),this.pres.push(i),this.segments.push(e),this.length=this.segments.reduce(((t,e)=>t+e),0),this.angles.push(t)}endPlot(t=0,e=1,i=!1){t=i?(t%360+360)%360:b.toDegrees(t),this.angles.splice(-1),this.angles.push(t),this.pres.push(e)}rotate(t){this.dir=b.toDegrees(t)}pressure(t){return t>this.length?this.pres[this.pres.length-1]:this.curving(this.pres,t)}angle(t){return t>this.length?this.angles[this.angles.length-1]:(this.calcIndex(t),"curve"===this.type?this.curving(this.angles,t)+this.dir:this.angles[this.index]+this.dir)}curving(t,e){let i=t[this.index],s=t[this.index+1];return void 0===s&&(s=i),Math.abs(s-i)>180&&(s>i?s=-(360-s):i=-(360-i)),b.map(e-this.suma,0,this.segments[this.index],i,s,!0)}calcIndex(t){this.index=-1,this.suma=0;let e=0;for(;e<=t;)this.suma=e,e+=this.segments[this.index+1],this.index++;return this.index}genPol(t,e,i=1,s=!1){v();const n=.5,r=[],o=Math.round(this.length/n),a=new O(t,e);let c=s?.15:3*ft.bleed_strength,h=0,l=0;for(let t=0;t<o;t++){a.plotTo(this,n,n,1);let t=this.calcIndex(a.plotted);h+=n,(h>=this.segments[t]*c*b.rr(.7,1.3)||t>=l)&&a.x&&(r.push([a.x,a.y]),h=0,t>=l&&l++)}return new Z(r)}draw(t,e,i){Y.isActive&&(v(),this.origin&&(t=this.origin[0],e=this.origin[1],i=1),$(this,t,e,i))}fill(t,e,i){ft.isActive&&(v(),this.origin&&(t=this.origin[0],e=this.origin[1],i=1),this.pol=this.genPol(t,e,i),this.pol.fill())}hatch(t,e,i){K.isActive&&(v(),this.origin&&(t=this.origin[0],e=this.origin[1],i=1),this.pol=this.genPol(t,e,i,!0),this.pol.hatch())}erase(t,e,i){ct.isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],i=1),this.pol=this.genPol(t,e,i,!0),I.blend(ct.c),I.isErase=!0,I.ctx.save(),I.ctx.fillStyle=T(ct.c)+ct.a+"%)",tt(this.pol.vertices),I.ctx.fill(),I.ctx.restore())}show(t,e,i=1){this.draw(t,e,i),this.fill(t,e,i),this.hatch(t,e,i),this.erase(t,e,i)}}let it,st=!1;function nt(t=0){it=b.constrain(t,0,1),st=[]}function rt(t,e,i){st.push([t,e,i])}function ot(t){"close"===t&&(st.push(st[0]),st.push(st[1])),(0!=it||X.isActive?at(st,it,"close"===t):new Z(st)).show(),st=!1}function at(t,e=.5,i=!1){let s=new et(0===e?"segments":"curve");if(t&&t.length>0){let n,r,o,a=0;for(let c=0;c<t.length-1;c++)if(e>0&&c<t.length-2){let h=t[c],l=t[c+1],u=t[c+2],f=b.dist(h[0],h[1],l[0],l[1]),m=b.dist(l[0],l[1],u[0],u[1]),p=b.calcAngle(h[0],h[1],l[0],l[1]),x=b.calcAngle(l[0],l[1],u[0],u[1]),d=e*Math.min(Math.min(f,m),.5*Math.min(f,m)),g=Math.max(f,m),v=f-d,y=m-d;if(Math.floor(p)===Math.floor(x)){let e=i&&0===c?0:f-a,u=i?0===c?0:m-o:m;s.addSegment(p,e,h[2],!0),c===t.length-3&&s.addSegment(x,u,l[2],!0),a=0,0===c&&(n=f,o=d,r=t[1],a=0)}else{let e={x:l[0]-d*b.cos(-p),y:l[1]-d*b.sin(-p)},u={x:e.x+g*b.cos(90-p),y:e.y+g*b.sin(90-p)},f={x:l[0]+d*b.cos(-x),y:l[1]+d*b.sin(-x)},m=z(e,u,f,{x:f.x+g*b.cos(90-x),y:f.y+g*b.sin(90-x)},!0),w=b.dist(e.x,e.y,m.x,m.y),_=b.dist(e.x,e.y,f.x,f.y)/2,A=2*Math.asin(_/w)*(180/Math.PI),k=N*w*A/360,M=i&&0===c?0:v-a,S=c===t.length-3?i?n-d:y:0;s.addSegment(p,M,h[2],!0),s.addSegment(p,isNaN(k)?0:k,h[2],!0),s.addSegment(x,S,l[2],!0),a=d,0===c&&(n=v,o=d,r=[e.x,e.y])}c==t.length-3&&s.endPlot(x,l[2],!0)}else if(0===e){0===c&&i&&t.pop();let e=t[c],n=t[c+1],r=b.dist(e[0],e[1],n[0],n[1]),o=b.calcAngle(e[0],e[1],n[0],n[1]);s.addSegment(o,r,n[2],!0),c==t.length-2&&s.endPlot(o,1,!0)}s.origin=i&&0!==e?r:t[0]}return s}const ct={};function ht(t,e,i,s){v(),ft.opacity=arguments.length<4?e:s,ft.color=arguments.length<3?new C(t):new C(t,e,i),ft.isActive=!0}function lt(t,e="out"){v(),ft.bleed_strength=b.constrain(t,0,1),ft.direction=e}function ut(t=.4,e=.4){v(),ft.texture_strength=b.constrain(t,0,1),ft.border_strength=b.constrain(e,0,1)}const ft={isActive:!1,isAnimated:!1,color:new C("#002185"),opacity:60,bleed_strength:.07,texture_strength:.4,border_strength:.4,fill(t){this.polygon=t;let e=[...t.vertices];const i=e.length;let s=b.randInt(0,i);const n=i*b.rr(.2,.4),r=this.bleed_strength;ft.m=e.map(((t,e)=>{let i=b.rr(.5,1.4)*r;return e<n?i:.25*i})),s-=~~(.15*i),e=[...e.slice(s),...e.slice(0,s)],new mt(e,this.m,this.calcCenter(e),[],!0).fill(this.color,b.map(this.opacity,0,100,0,1,!0),this.texture_strength,!0)},calcCenter(t){let e=0,i=0;for(let s=0;s<t.length;++s)e+=t[s].x,i+=t[s].y;return e/=t.length,i/=t.length,{x:e,y:i}}};class mt{constructor(t,e,i,s,n=!1){this.pol=new Z(t,!0),this.v=t,this.dir=s,this.m=e,this.midP=i,this.size=-1/0;for(let t of this.v)this.size=Math.max(b.dist(this.midP.x,this.midP.y,t.x,t.y),this.size);if(n)for(let t=0;t<this.v.length;t++){const e=this.v[t],i=this.v[(t+1)%this.v.length],s={x:i.x-e.x,y:i.y-e.y},n=M(0,0,s.x,s.y,90);let r={point1:{x:e.x+s.x/2,y:e.y+s.y/2},point2:{x:e.x+s.x/2+n.x,y:e.y+s.y/2+n.y}};const o=(t,e,i)=>(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)>.01;let a=0;for(let t of ft.polygon.intersect(r))o(e,i,t)&&a++;this.dir[t]=a%2==0}}trim(t=1){let e=[...this.v],i=[...this.m],s=[...this.dir];if(this.v.length>8&&t>=0&&1!==t){let n=~~((1-t)*this.v.length),r=~~this.v.length/2-~~n/2;e.splice(r,n),i.splice(r,n),s.splice(r,n)}return{v:e,m:i,dir:s}}grow(t=1,e){const i=[],s=[],n=[],r=this.trim(t),o=r.v,a=r.m,c=r.dir,h=o.length,l=e?-.5:1,u="out"===ft.direction?-90:90;let f=999===t&&(ft.bleed_strength<=.1?.25:.75);for(let t=0;t<h;t++){const e=o[t],r=o[(t+1)%h];let m=f||a[t];m*=l;let p={x:r.x-e.x,y:r.y-e.y},x=(c[t]?u:-u)+45*b.rr(-.4,.4),d=M(0,0,p.x,p.y,x),g=b.constrain(b.gaussian(.5,.2),.1,.9),v=b.gaussian(.5,.2)*b.rr(.6,1.4)*m,y={x:e.x+p.x*g+d.x*v,y:e.y+p.y*g+d.y*v};i.push(e,y),s.push(m,m+b.pseudoGaussian(0,.01)),n.push(c[t],c[t])}return new mt(i,s,this.midP,n)}fill(t,e,i){const s=3*i,n=2*e;I.blend(t),I.ctx.save(),I.ctx.strokeStyle=T(t)+.05*ft.border_strength+")",I.ctx.lineWidth=0,I.ctx.fillStyle=T(t)+n+"%)";let r,o=this.grow();for(;o.v.length<=15;)o=o.grow();for(let t=0;t<24;t++){t%4==0&&(o=o.grow(),r=[o.grow(1-.0125*t),o.grow(.6-.0125*t),o.grow(.35-.0125*t)],r[2].grow(999).layer());for(let t of r)t.grow(999,!0).grow(999).layer();0!==s&&t%2==0&&o.erase(s,e)}I.ctx.restore()}layer(){tt(this.v),I.ctx.stroke(),I.ctx.fill()}erase(t,e){I.ctx.save(),x&&(tt(this.v),I.ctx.clip());const i=b.rr(110,170)*b.map(t,0,1,2,3),s=this.size/2,n=.015*this.size,r=.2*this.size,o=this.midP.x,a=this.midP.y;I.ctx.globalCompositeOperation="destination-out";let c=(5-b.map(e,80,120,.3,2,!0))*t;I.ctx.fillStyle=T(this.color)+c/255+")",I.ctx.lineWidth=0;for(let t=0;t<i;t++){const e=o+b.gaussian(0,s),i=a+b.gaussian(0,s),c=b.rr(n,r);I.ctx.beginPath(),Y.circle(e,i,c),t%4!=0&&I.ctx.fill()}I.ctx.globalCompositeOperation="source-over",I.ctx.restore()}}const pt=["weight","vibration","definition","quality","opacity","spacing","pressure","type","tip","rotate"],xt=[["pen",[.35,.12,.5,8,88,.3,{curve:[.15,.2],min_max:[1.4,.9]}]],["rotring",[.2,.05,.5,30,115,.15,{curve:[.35,.2],min_max:[1.3,.9]}]],["2B",[.35,.6,.1,8,140,.2,{curve:[.15,.2],min_max:[1.5,1]}]],["HB",[.3,.5,.4,4,130,.25,{curve:[.15,.2],min_max:[1.2,.9]}]],["2H",[.2,.4,.3,2,100,.2,{curve:[.15,.2],min_max:[1.2,.9]}]],["cpencil",[.4,.6,.8,7,75,.15,{curve:[.15,.2],min_max:[.95,1.2]}]],["charcoal",[.5,2,.8,300,70,.06,{curve:[.15,.2],min_max:[1.5,.8]}]],["hatch_brush",[.2,.4,.3,2,135,.15,{curve:[.5,.7],min_max:[1,1.5]}]],["spray",[.2,12,15,40,35,.65,{curve:[0,.1],min_max:[1,1]},"spray"]],["marker",[2.5,.12,null,null,25,.4,{curve:[.35,.25],min_max:[1.5,1]},"marker"]]];for(let t of xt){let e={};for(let i=0;i<t[1].length;i++)e[pt[i]]=t[1][i];W(t[0],e)}let dt,gt=0,vt=!0;let yt=30;function wt(e){vt&&(e>gt+1e3/yt||0===e)&&(gt=e,t.frameCount++,dt(),F()),requestAnimationFrame(wt)}t.frameCount=0,t.Plot=et,t.Polygon=Z,t.Position=O,t.add=W,t.addField=U,t.arc=function(t,e,i,s,n){v();let r=new et("curve"),o=270-b.toDegrees(s),a=270-b.toDegrees(n),c=b.toDegrees(n-s),h=Math.PI*i*c/180;r.addSegment(o,h,1,!0),r.endPlot(a,1,!0),r.draw(t+i*b.cos(-o-90),e+i*b.sin(-o-90),1)},t.background=function(t,e,i){P="transparent"===t?new C(e):new C(...arguments),x?"transparent"===t?I.ctx.clearRect(0,0,f,m):(I.ctx.beginPath(),I.ctx.fillStyle=P.hex,I.ctx.fillRect(0,0,f,m)):I.worker.postMessage({color:P.gl,isBG:!0})},t.beginShape=nt,t.beginStroke=function(t,e,i){it=[e,i],st=new et(t)},t.bleed=lt,t.box=function(){return Array.from(Y.list.keys())},t.circle=function(t,e,i,s=!1){let n=new et("curve"),r=Math.PI*i/2,o=b.rr(0,360),a=()=>s?1+.2*b.rr():1;n.addSegment(0+o*a(),r*a(),1,!0),n.addSegment(o*a()-90,r*a(),1,!0),n.addSegment(o*a()-180,r*a(),1,!0),n.addSegment(o*a()-270,r*a(),1,!0);let c=s?b.randInt(-5,5):0;s&&n.addSegment(o,Math.abs(c)*(Math.PI/180)*i,1,!0),n.endPlot(c+o,1,!0);let h=[t-i*b.sin(o),e-i*b.cos(-o)];n.show(h[0],h[1],1)},t.clip=function(t){Y.cr=t},t.drawImage=function(t,e=0,i=0,s=t.width,n=t.height){"[object ImageBitmap]"===Object.prototype.toString.call(t)&&0===e||(I.ctx.drawImage(...arguments),t=I.mask.transferToImageBitmap()),I.blend(!1,!1,t)},t.endFrame=F,t.endShape=ot,t.endStroke=function(t,e){st.endPlot(t,e),st.draw(it[0],it[1],1),st=!1},t.erase=function(t=P,e=255){ct.isActive=!0,ct.c=new C(t),ct.a=e},t.field=function(t){v(),X.isActive=!0,X.current=t},t.fill=ht,t.fillAnimatedMode=function(t){ft.isAnimated=t},t.fillTexture=ut,t.flowLine=function(t,e,i,s){v(),Y.initializeDrawingState(t,e,i,!0,!1),Y.draw(b.toDegrees(s),!1)},t.frameRate=yt,t.getCanvas=async function(){let t;return await new Promise((function(e){I.worker.postMessage({get:!0}),I.worker.onmessage=function(i){0!==i.data&&(t=i.data.canvas,e())}})),t},t.hatch=V,t.hatchArray=Q,t.line=G,t.listFields=function(){return Array.from(X.list.keys())},t.load=g,t.loop=function(t){dt=t,vt=!0,requestAnimationFrame(wt)},t.noClip=function(){Y.cr=null},t.noErase=function(){ct.isActive=!1},t.noField=function(){X.isActive=!1},t.noFill=function(){ft.isActive=!1},t.noHatch=function(){K.isActive=!1,K.hatchingBrush=!1},t.noLoop=function(){vt=!1},t.noStroke=function(){Y.isActive=!1},t.noiseSeed=function(e){t.noise=o(a(e))},t.pick=q,t.plot=$,t.polygon=function(t){new Z(t).show()},t.preload=function(){j.load()},t.random=A,t.rect=function(t,e,i,s,n="corner"){if("center"==n&&(t-=i/2,e-=s/2),X.isActive)nt(0),rt(t,e),rt(t+i,e),rt(t+i,e+s),rt(t,e+s),ot("close");else{new Z([[t,e],[t+i,e],[t+i,e+s],[t,e+s]]).show()}},t.refreshField=function(t){X.refresh(t)},t.restore=function(){I.ctx.restore();let t=I.ctx.getTransform();B.x=t.e,B.y=t.f,X.isActive=S.field.isActive,X.current=S.field.current,Y.isActive=S.stroke.isActive,Y.name=S.stroke.name,Y.c=S.stroke.color,Y.w=S.stroke.weight,Y.cr=S.stroke.clip,K.isActive=S.hatch.isActive,K.hatchingParams=S.hatch.hatchingParams,K.hatchingBrush=S.hatch.hatchingBrush,ft.isActive=S.fill.isActive,ft.color=S.fill.color,ft.opacity=S.fill.opacity,ft.bleed_strength=S.fill.bleed_strength,ft.texture_strength=S.fill.texture_strength,ft.border_strength=S.fill.border_strength},t.rotate=function(t=0){I.ctx.rotate(t)},t.save=function(){I.ctx.save(),S.field.isActive=X.isActive,S.field.current=X.current,S.stroke.isActive=Y.isActive,S.stroke.name=Y.name,S.stroke.color=Y.c,S.stroke.weight=Y.w,S.stroke.clip=Y.cr,S.hatch.isActive=K.isActive,S.hatch.hatchingParams=K.hatchingParams,S.hatch.hatchingBrush=K.hatchingBrush,S.fill.isActive=ft.isActive,S.fill.color=ft.color,S.fill.opacity=ft.opacity,S.fill.bleed_strength=ft.bleed_strength,S.fill.texture_strength=ft.texture_strength,S.fill.border_strength=ft.border_strength},t.scale=D,t.scaleBrushes=L,t.seed=function(t){w=a(t)},t.segment=function(t,e,i){st.addSegment(t,e,i)},t.set=H,t.setDensity=function(t){p=t,L(p)},t.setHatch=function(t,e="black",i=1){K.hatchingBrush=[t,e,i]},t.setMobile=y,t.spline=function(t,e=.5){at(t,e).draw()},t.stroke=function(t,e,i){Y.c=new C(...arguments),Y.isActive=!0},t.strokeWeight=function(t){Y.w=t},t.translate=function(t,e){I.ctx.translate(t,e);let i=I.ctx.getTransform();B.x=i.e,B.y=i.f},t.vertex=rt,t.wRand=k}));
