var t,e;t=this,e=function(t){const e=Math.sqrt(3),i=.5*(e-1),n=(3-e)/6,o=t=>0|Math.floor(t),s=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function r(t=Math.random){const e=function(t){const e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let i=0;i<255;i++){const n=i+~~(t()*(256-i)),o=e[i];e[i]=e[n],e[n]=o}for(let t=256;t<512;t++)e[t]=e[t-256];return e}(t),r=new Float64Array(e).map((t=>s[t%12*2])),a=new Float64Array(e).map((t=>s[t%12*2+1]));return function(t,s){let c=0,l=0,u=0;const h=(t+s)*i,f=o(t+h),m=o(s+h),x=(f+m)*n,d=t-(f-x),g=s-(m-x);let p,v;d>g?(p=1,v=0):(p=0,v=1);const y=d-p+n,w=g-v+n,_=d-1+2*n,k=g-1+2*n,b=255&f,E=255&m;let A=.5-d*d-g*g;if(A>=0){const t=b+e[E];A*=A,c=A*A*(r[t]*d+a[t]*g)}let z=.5-y*y-w*w;if(z>=0){const t=b+p+e[E+v];z*=z,l=z*z*(r[t]*y+a[t]*w)}let T=.5-_*_-k*k;if(T>=0){const t=b+1+e[E+1];T*=T,u=T*T*(r[t]*_+a[t]*k)}return 70*(c+l+u)}}function a(t,e){let i=new c(t),n=()=>i.next();return n.double=()=>n()+11102230246251565e-32*(2097152*n()|0),n.int32=()=>4294967296*i.next()|0,n.quick=n,n}class c{constructor(t){null==t&&(t=+new Date);let e=4022871197;function i(t){t=String(t);for(let i=0;i<t.length;i++){e+=t.charCodeAt(i);let n=.02519603282416938*e;e=n>>>0,n-=e,n*=e,e=n>>>0,n-=e,e+=4294967296*n}return 2.3283064365386963e-10*(e>>>0)}this.c=1,this.s0=i(" "),this.s1=i(" "),this.s2=i(" "),this.s0-=i(t),this.s0<0&&(this.s0+=1),this.s1-=i(t),this.s1<0&&(this.s1+=1),this.s2-=i(t),this.s2<0&&(this.s2+=1)}next(){let{c:t,s0:e,s1:i,s2:n}=this,o=2091639*e+2.3283064365386963e-10*t;return this.s0=i,this.s1=n,this.s2=o-(this.c=0|o)}copy(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}}let l=a(Math.random()),u=a(Math.random());function h(t=0,e=1){return Array.isArray(t)?t[~~(l()*t.length)]:1===arguments.length?l()*t:f(...arguments)}t.noise=r(u);const f=(t=0,e=1)=>t+l()*(e-t),m=(t,e)=>~~f(t,e);function x(t=0,e=1){const i=1-l(),n=l();return Math.sqrt(-2*Math.log(i))*y(360*n)*e+t}function d(t){let e=0;const i=[];for(const n in t)e+=t[n],i.push({key:n,cumulative:e});const n=l()*e;for(const t of i)if(n<t.cumulative)return isNaN(t.key)?t.key:parseInt(t.key)}function g(t,e,i,n,o,s=!1){let r=n+(t-e)/(i-e)*(o-n);return s?n<o?p(r,n,o):p(r,o,n):r}function p(t,e,i){return Math.max(Math.min(t,i),e)}function v(t){return(t%=360)<0?t+360:t}function y(t){return b[~~(4*v(t))]}function w(t){return E[~~(4*v(t))]}const _=1440,k=2*Math.PI/_,b=new Float32Array(_),E=new Float32Array(_);for(let t=0;t<_;t++){const e=t*k;b[t]=Math.cos(e),E[t]=Math.sin(e)}const A=t=>{let e=180*t/Math.PI%360;return e<0?e+360:e},z=(t,e,i,n)=>Math.sqrt((i-t)*(i-t)+(n-e)*(n-e)),T=(t,e,i,n)=>A(Math.atan2(-(n-e),i-t));function M(t,e,i,n,o=!1){let s=t.x,r=t.y,a=e.x,c=e.y,l=i.x,u=i.y,h=n.x,f=n.y;if(s===a&&r===c||l===h&&u===f)return!1;let m=a-s,x=c-r,d=h-l,g=f-u,p=g*m-d*x;if(0===p)return!1;let v=(d*(r-u)-g*(s-l))/p,y=(m*(r-u)-x*(s-l))/p;return!(!o&&(y<0||y>1))&&{x:s+v*m,y:r+v*x}}function R(t,e,i,n,o){let s=y(o),r=w(o);return{x:s*(i-t)+r*(n-e)+t,y:s*(n-e)-r*(i-t)+e}}function F(t){return t.map((function(t){return t.slice()}))}Worker.createURL=function(t){const e="function"==typeof t?t.toString():t,i=new Blob(["'use strict';\nself.onmessage="+e],{type:"text/javascript"});return window.URL.createObjectURL(i)},Worker.create=function(t){return new Worker(Worker.createURL(t))};const I={};let B,C,S,P=!1;const X={},U=document.createElement("canvas");U.width=1,U.height=1;const D=U.getContext("2d");class Y{constructor(t,e,i){if(isNaN(t)){this.hex=this.standardize(t);let e=this.hexToRgb(this.hex);this.r=e.r,this.g=e.g,this.b=e.b}else t=p(t,0,255),e=p(e,0,255),i=p(i,0,255),this.r=t,this.g=isNaN(e)?t:e,this.b=isNaN(i)?t:i,this.hex=this.rgbToHex(this.r,this.g,this.b);this.gl=[this.r/255,this.g/255,this.b/255,1]}rgbToHex(t,e,i){return"#"+(1<<24|t<<16|e<<8|i).toString(16).slice(1)}hexToRgb(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,n){return e+e+i+i+n+n}));let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}standardize(t){return D.fillStyle=t,D.fillStyle}}function N(){L.loaded||(function(){if(!P)throw new Error("Canvas system is not ready. Call `load()` first.")}(),L.load())}const L={loaded:!1,isBlending:!1,currentColor:new Y("white").gl,load(){if(!I[B].worker){const t=I[B];t.mask=new OffscreenCanvas(C,S),t.glMask=new OffscreenCanvas(C,S),t.ctx=t.mask.getContext("2d"),t.gl=t.glMask.getContext("webgl2"),t.ctx.lineWidth=0,t.offscreen=I[B].canvas.transferControlToOffscreen(),t.worker=Worker.create((function(t){let e,i;const n={};function o(){const t=i.createTexture();return i.bindTexture(i.TEXTURE_2D,t),i.texStorage2D(i.TEXTURE_2D,1,i.RGBA8,e.width,e.height),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),t}function s(){let t=o();const e=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,e),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),{texture:t,fbo:e}}function r(){return self.navigator&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent)}function a(){i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)}onmessage=async t=>{t.data.canvas?(e=t.data.canvas,function(){i=e.getContext("webgl2",{antialias:!1});const t=(t=>{const e=t.createProgram();for(let[i,n]of[[t.VERTEX_SHADER,"#version 300 es\n    out vec2 p;void main(){vec3 v=vec3(-1);v[gl_VertexID]=3.;gl_Position=vec4(p=v.xy,0,1);}"],[t.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;uniform vec4 u_addColor;uniform bool u_isErase,u_isImage,u_isBrush;uniform sampler2D u_source,u_mask;in vec2 p;out vec4 outColor;float x(float v){return v<.04045?v/12.92:pow((v+.055)/1.055,2.4);}float f(float v){return v<.0031308?v*12.92:1.055*pow(v,1./2.4)-.055;}vec3 v(vec3 v){return vec3(x(v[0]),x(v[1]),x(v[2]));}vec3 n(vec3 v){return clamp(vec3(f(v[0]),f(v[1]),f(v[2])),0.,1.);}void f(vec3 e,out float m,out float f,out float v,out float u,out float i,out float r,out float z){m=min(e.x,min(e.y,e.z));e-=m;f=min(e.y,e.z);v=min(e.x,e.z);u=min(e.x,e.y);i=min(max(0.,e.x-e.z),max(0.,e.x-e.y));r=min(max(0.,e.y-e.z),max(0.,e.y-e.x));z=min(max(0.,e.z-e.y),max(0.,e.z-e.x));}void f(vec3 v,inout float u[38]){float e,o,m,x,k,z,y;f(v,e,o,m,x,k,z,y);u[0]=max(1e-4,e+o*.96853629+m*.51567122+x*.02055257+k*.03147571+z*.49108579+y*.97901834);u[1]=max(1e-4,e+o*.96855103+m*.5401552+x*.02059936+k*.03146636+z*.46944057+y*.97901649);u[2]=max(1e-4,e+o*.96859338+m*.62645502+x*.02062723+k*.03140624+z*.4016578+y*.97901118);u[3]=max(1e-4,e+o*.96877345+m*.75595012+x*.02073387+k*.03119611+z*.2449042+y*.97892146);u[4]=max(1e-4,e+o*.96942204+m*.92826996+x*.02114202+k*.03053888+z*.0682688+y*.97858555);u[5]=max(1e-4,e+o*.97143709+m*.97223624+x*.02233154+k*.02856855+z*.02732883+y*.97743705);u[6]=max(1e-4,e+o*.97541862+m*.98616174+x*.02556857+k*.02459485+z*.013606+y*.97428075);u[7]=max(1e-4,e+o*.98074186+m*.98955255+x*.03330189+k*.0192952+z*.01000187+y*.96663223);u[8]=max(1e-4,e+o*.98580992+m*.98676237+x*.05185294+k*.01423112+z*.01284127+y*.94822893);u[9]=max(1e-4,e+o*.98971194+m*.97312575+x*.10087639+k*.01033111+z*.02636635+y*.89937713);u[10]=max(1e-4,e+o*.99238027+m*.91944277+x*.24000413+k*.00765876+z*.07058713+y*.76070164);u[11]=max(1e-4,e+o*.99409844+m*.32564851+x*.53589066+k*.00593693+z*.70421692+y*.4642044);u[12]=max(1e-4,e+o*.995172+m*.13820628+x*.79874659+k*.00485616+z*.85473994+y*.20123039);u[13]=max(1e-4,e+o*.99576545+m*.05015143+x*.91186529+k*.00426186+z*.95081565+y*.08808402);u[14]=max(1e-4,e+o*.99593552+m*.02912336+x*.95399623+k*.00409039+z*.9717037+y*.04592894);u[15]=max(1e-4,e+o*.99564041+m*.02421691+x*.97137099+k*.00438375+z*.97651888+y*.02860373);u[16]=max(1e-4,e+o*.99464769+m*.02660696+x*.97939505+k*.00537525+z*.97429245+y*.02060067);u[17]=max(1e-4,e+o*.99229579+m*.03407586+x*.98345207+k*.00772962+z*.97012917+y*.01656701);u[18]=max(1e-4,e+o*.98638762+m*.04835936+x*.98553736+k*.0136612+z*.9425863+y*.01451549);u[19]=max(1e-4,e+o*.96829712+m*.0001172+x*.98648905+k*.03181352+z*.99989207+y*.01357964);u[20]=max(1e-4,e+o*.89228016+m*8.554e-5+x*.98674535+k*.10791525+z*.99989891+y*.01331243);u[21]=max(1e-4,e+o*.53740239+m*.85267882+x*.98657555+k*.46249516+z*.13823139+y*.01347661);u[22]=max(1e-4,e+o*.15360445+m*.93188793+x*.98611877+k*.84604333+z*.06968113+y*.01387181);u[23]=max(1e-4,e+o*.05705719+m*.94810268+x*.98559942+k*.94275572+z*.05628787+y*.01435472);u[24]=max(1e-4,e+o*.03126539+m*.94200977+x*.98507063+k*.96860996+z*.06111561+y*.01479836);u[25]=max(1e-4,e+o*.02205445+m*.91478045+x*.98460039+k*.97783966+z*.08987709+y*.0151525);u[26]=max(1e-4,e+o*.01802271+m*.87065445+x*.98425301+k*.98187757+z*.13656016+y*.01540513);u[27]=max(1e-4,e+o*.0161346+m*.78827548+x*.98403909+k*.98377315+z*.22169624+y*.01557233);u[28]=max(1e-4,e+o*.01520947+m*.65738359+x*.98388535+k*.98470202+z*.32176956+y*.0156571);u[29]=max(1e-4,e+o*.01475977+m*.59909403+x*.98376116+k*.98515481+z*.36157329+y*.01571025);u[30]=max(1e-4,e+o*.01454263+m*.56817268+x*.98368246+k*.98537114+z*.4836192+y*.01571916);u[31]=max(1e-4,e+o*.01444459+m*.54031997+x*.98365023+k*.98546685+z*.46488579+y*.01572133);u[32]=max(1e-4,e+o*.01439897+m*.52110241+x*.98361309+k*.98550011+z*.47440306+y*.01572502);u[33]=max(1e-4,e+o*.0143762+m*.51041094+x*.98357259+k*.98551031+z*.4857699+y*.01571717);u[34]=max(1e-4,e+o*.01436343+m*.50526577+x*.98353856+k*.98550741+z*.49267971+y*.01571905);u[35]=max(1e-4,e+o*.01435687+m*.5025508+x*.98351247+k*.98551323+z*.49625685+y*.01571059);u[36]=max(1e-4,e+o*.0143537+m*.50126452+x*.98350101+k*.98551563+z*.49807754+y*.01569728);u[37]=max(1e-4,e+o*.01435408+m*.50083021+x*.98350852+k*.98551547+z*.49889859+y*.0157002);}vec3 w(vec3 e){mat3 u;u[0]=vec3(3.24306333,-1.53837619,-.49893282);u[1]=vec3(-.96896309,1.87542451,.04154303);u[2]=vec3(.05568392,-.20417438,1.05799454);float v=dot(u[0],e),o=dot(u[1],e),z=dot(u[2],e);return n(vec3(v,o,z));}vec3 m(float u[38]){return vec3(0)+u[0]*vec3(6.469e-5,1.84e-6,.00030502)+u[1]*vec3(.00021941,6.21e-6,.00103681)+u[2]*vec3(.00112057,3.101e-5,.00531314)+u[3]*vec3(.00376661,.00010475,.01795439)+u[4]*vec3(.01188055,.00035364,.05707758)+u[5]*vec3(.02328644,.00095147,.11365162)+u[6]*vec3(.03455942,.00228226,.17335873)+u[7]*vec3(.03722379,.00420733,.19620658)+u[8]*vec3(.03241838,.0066888,.18608237)+u[9]*vec3(.02123321,.0098884,.13995048)+u[10]*vec3(.01049099,.01524945,.08917453)+u[11]*vec3(.00329584,.02141831,.04789621)+u[12]*vec3(.00050704,.03342293,.02814563)+u[13]*vec3(.00094867,.05131001,.01613766)+u[14]*vec3(.00627372,.07040208,.0077591)+u[15]*vec3(.01686462,.08783871,.00429615)+u[16]*vec3(.02868965,.09424905,.00200551)+u[17]*vec3(.04267481,.09795667,.00086147)+u[18]*vec3(.05625475,.09415219,.00036904)+u[19]*vec3(.0694704,.08678102,.00019143)+u[20]*vec3(.08305315,.07885653,.00014956)+u[21]*vec3(.0861261,.0635267,9.231e-5)+u[22]*vec3(.09046614,.05374142,6.813e-5)+u[23]*vec3(.08500387,.04264606,2.883e-5)+u[24]*vec3(.07090667,.03161735,1.577e-5)+u[25]*vec3(.05062889,.02088521,3.94e-6)+u[26]*vec3(.03547396,.01386011,1.58e-6)+u[27]*vec3(.02146821,.00810264,0)+u[28]*vec3(.01251646,.0046301,0)+u[29]*vec3(.00680458,.00249138,0)+u[30]*vec3(.00346457,.0012593,0)+u[31]*vec3(.00149761,.00054165,0)+u[32]*vec3(.0007697,.00027795,0)+u[33]*vec3(.00040737,.00014711,0)+u[34]*vec3(.00016901,6.103e-5,0)+u[35]*vec3(9.522e-5,3.439e-5,0)+u[36]*vec3(4.903e-5,1.771e-5,0)+u[37]*vec3(2e-5,7.22e-6,0);}float f(float m,float z,float v){z*=pow(v,2.);return z/(m*pow(1.-v,2.)+z);}vec3 m(vec3 e,vec3 u,float z){float o[38],p[38];f(v(e),o);f(v(u),p);float x=m(o)[1],k=m(p)[1];z=f(x,k,z);float i[38];for(int u=0;u<38;u++){float v=(1.-z)*(pow(1.-o[u],2.)/(2.*o[u]))+z*(pow(1.-p[u],2.)/(2.*p[u]));i[u]=1.+v-sqrt(pow(v,2.)+2.*v);}return w(m(i));}void main(){vec2 e=.5*vec2(p)+.5;vec4 v=texture(u_source,e);if(u_isImage)outColor=texture(u_mask,e);else{vec4 u=texture(u_mask,e);if(u.x>0.){vec4 o=vec4(u_addColor.xyz,1);if(u.w>.7&&!u_isErase){float v=.5*(u.w-.7);o=o*(1.-v)-vec4(.5)*v;}float f=u.w;if(!u_isBrush){vec2 v=1./vec2(textureSize(u_mask,0));float z=0.,m=0.;for(int u=-2;u<=2;u++)for(int f=-2;f<=2;f++){vec2 o=vec2(float(u),float(f))*v;float p=texture(u_mask,e+o).w*15.;z+=smoothstep(.05,.35,length(vec2(dFdx(p),dFdy(p))));m+=1.;}z/=m;f=clamp(u.w+z*.2,0.,1.);}vec3 z=m(v.xyz,o.xyz,f);outColor=vec4(z,1);}else outColor=v;}}"]]){const o=t.createShader(i);t.shaderSource(o,n),t.compileShader(o),t.attachShader(e,o)}return t.linkProgram(e),e})(i);i.useProgram(t),["u_addColor","u_isErase","u_isImage","u_isBrush","u_source","u_mask"].forEach((e=>{n[e]=i.getUniformLocation(t,e)})),n.mask=o(),n.source=s(),n.target=s(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,n.source.texture),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,n.mask),i.uniform1i(n.u_source,0),i.uniform1i(n.u_mask,1)}(),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n.source.fbo),i.clearColor(1,1,1,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):t.data.isBG?(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n.source.fbo),i.clearColor(...t.data.color),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):t.data.mask&&function(t){let e;if(r()){const i=new OffscreenCanvas(t.mask.width,t.mask.height).getContext("2d");i.drawImage(t.mask,0,0),e=i.getImageData(0,0,t.mask.width,t.mask.height)}i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,r()?e:t.mask),t.mask.close(),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n.target.fbo),i.uniform1i(n.u_isImage,t.isImage?1:0),i.uniform1i(n.u_isBrush,t.isBrush?1:0),t.isImage||(i.uniform1i(n.u_isImage,!1),i.uniform4f(n.u_addColor,...t.addColor),i.uniform1i(n.u_isErase,!!t.isErase)),i.drawArrays(i.TRIANGLES,0,3),i.bindFramebuffer(i.READ_FRAMEBUFFER,n.target.fbo),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n.source.fbo),a(),t.isLast&&!t.sp&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,n.target.fbo),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),a())}(t.data)}})),t.worker.postMessage("init"),t.worker.postMessage({canvas:t.offscreen},[t.offscreen])}Object.assign(this,I[B])},blend(t=!1,e=!1,i=!1,n=!1){N(),!this.isBlending&&t&&(this.currentColor=t.gl,this.isBlending=!0);const o=t?t.gl:this.currentColor;if(e||i||o.toString()!==this.currentColor.toString()){const o=i||this.isBrush?this.glMask.transferToImageBitmap():this.mask.transferToImageBitmap();this.worker.postMessage({addColor:this.currentColor,mask:o,isLast:e,isErase:this.isErase,isImage:Boolean(i),sp:n,isBrush:this.isBrush},[o]),this.isErase=!1,this.isBrush=!1,e||(this.currentColor=t.gl),e&&!n&&(this.isBlending=!1)}}};let O=new Y("white");const W={x:0,y:0};let q=!1;function H(){q||(N(),V=.01*C,j=-.5*C,$=-.5*S,J=Math.round(2*C/V),K=Math.round(2*S/V),tt("hand",(function(e,i){const n=f(.2,.8),o=m(5,10),s=.1*e;for(let r=0;r<J;r++){const a=.1*r+s;for(let c=0;c<K;c++){const l=o*w(n*c*r+m(15,25)),u=t.noise(a,.1*c+s);i[r][c]=.5*l*y(e)+u*o*.5}}return i})),tt("seabed",(function(t,e){const i=f(.4,.8),n=m(18,26);for(let o=0;o<J;o++)for(let s=0;s<K;s++){const r=n*w(i*s*o+m(15,20));e[o][s]=1.1*r*y(t)}return e})),et.genField(),q=!0)}class G{constructor(t,e){this.update(t,e),this.plotted=0}update(t,e){this.x=t,this.y=e,this.column_index=G.getColIndex(t),this.row_index=G.getRowIndex(e)}reset(){this.plotted=0}isIn(){return X.field.isActive?G.isIn(this.column_index,this.row_index):this.isInCanvas(this.x,this.y)}isInCanvas(){const t=C,e=S,i=this.x+W.x,n=this.y+W.y;return i>=-.3*t&&i<=1.3*t&&n>=-.3*e&&n<=1.3*e}angle(){return this.isIn()&&X.field.isActive?Q.get(X.field.current).field[this.column_index][this.row_index]:0}moveTo(t,e,i,n=!0){if(!this.isIn())return void(this.plotted+=i);let o,s;for(let r=0;r<t/i;r++){if(n){const t=this.angle();o=y(t-e),s=w(t-e)}else o=y(-e),s=w(-e);const t=i*o,r=i*s;this.plotted+=i,this.update(this.x+t,this.y+r)}}plotTo(t,e,i,n){if(!this.isIn())return void(this.plotted+=i/n);const o=1/n;for(let n=0;n<e/i;n++){const e=this.angle(),n=t.angle(this.plotted),s=i*y(e-n),r=i*w(e-n);this.plotted+=i*o,this.update(this.x+s,this.y+r)}}static getRowIndex(t,e=1){const i=t+W.y-$;return Math.round(i/V/e)}static getColIndex(t,e=1){const i=t+W.x-j;return Math.round(i/V/e)}static isIn(t,e){return t>=0&&e>=0&&t<J&&e<K}}X.field={isActive:!1,current:null};let V,j,$,J,K,Q=new Map;function Z(t=1){return new Array(J/t).fill(null).map((()=>new Float32Array(K/t)))}function tt(t,e){Q.set(t,{gen:e}),Q.get(t).field=Q.get(t).gen(0,Z())}const et={d:4,genField(){this.field=Z(this.d),this.fieldTemp=Z(this.d)},get(t,e,i=!1){const n=G.getColIndex(t,this.d),o=G.getRowIndex(e,this.d),s=this.field?.[n]?.[o]??0;if(i){const t=Math.max(s,i),e=.75*(this.fieldTemp[n]?.[o]??0);return this.fieldTemp[n][o]=Math.max(t,e),t}return s},update(){for(let t=0;t<J/this.d;t++)for(let e=0;e<K/this.d;e++)this.field[t][e]=this.fieldTemp[t][e]},save(){this.A=F(this.field),this.B=F(this.fieldTemp)},restore(){this.field=this.A,this.fieldTemp=this.B}};let it={};function nt(t){L.ctx.beginPath(),t.forEach(((t,e)=>{0===e?L.ctx.moveTo(t.x,t.y):L.ctx.lineTo(t.x,t.y)})),L.ctx.closePath()}function ot(t,e,i){const n=2*Math.PI,o=i/2;L.ctx.moveTo(t+o,e),L.ctx.arc(t,e,o,0,n)}const st={isActive:!1,c:null,a:255};function rt(t){Mix.blend(st.c),Mix.isErase=!0,Mix.ctx.save(),Mix.ctx.fillStyle="rgb(255 0 0 / "+st.a+"%)",nt(t),Mix.ctx.fill(),Mix.ctx.restore()}class at{constructor(t,e=!1){this.a=t,this.vertices=e?t:t.map((([t,e])=>({x:t,y:e}))),this.sides=this.vertices.map(((t,e,i)=>[t,i[(e+1)%i.length]])),this._intersectionCache={}}intersect(t){const e=`${t.point1.x},${t.point1.y}-${t.point2.x},${t.point2.y}`;if(this._intersectionCache[e])return this._intersectionCache[e];const i=[];for(const[e,n]of this.sides){const o=M(t.point1,t.point2,e,n);o&&i.push(o)}return this._intersectionCache[e]=i,i}erase(){st.isActive&&rt(this.vertices)}show(){X.draw&&this.draw(),X.hatch&&this.hatch(),X.fill&&this.fill(),this.erase()}}class ct{constructor(t){this.segments=[],this.angles=[],this.pres=[],this.type=t,this.dir=0,this.calcIndex(0),this.pol=!1}addSegment(t=0,e=0,i=1,n=!1){this.angles.length>0&&this.angles.pop(),t=n?(t%360+360)%360:A(t),this.angles.push(t,t),this.pres.push(i),this.segments.push(e),this.length=this.segments.reduce(((t,e)=>t+e),0)}endPlot(t=0,e=1,i=!1){t=i?(t%360+360)%360:A(t),this.angles[this.angles.length-1]=t,this.pres.push(e)}rotate(t){this.dir=A(t)}pressure(t){return t>this.length?this.pres[this.pres.length-1]:this.curving(this.pres,t)}angle(t){return t>this.length?this.angles[this.angles.length-1]:(this.calcIndex(t),"curve"===this.type?this.curving(this.angles,t)+this.dir:this.angles[this.index]+this.dir)}curving(t,e){let i=t[this.index],n=t[this.index+1]??i;return Math.abs(n-i)>180&&(n>i?n=-(360-n):i=-(360-i)),g(e-this.suma,0,this.segments[this.index],i,n,!0)}calcIndex(t){this.index=-1,this.suma=0;let e=0;for(;e<=t;)this.suma=e,e+=this.segments[this.index+1],this.index++;return this.index}genPol(t,e,i=1,n){H();const o=.5,s=[],r=Math.round(this.length/o),a=new G(t,e);let c=0,l=0;for(let t=0;t<r;t++){a.plotTo(this,o,o,1);const t=this.calcIndex(a.plotted);c+=o,(c>=Math.max(this.segments[t]*n*f(.7,1.3),10)||t>=l)&&a.x&&(s.push([a.x,a.y]),c=0,t>=l&&l++)}return new at(s)}erase(t,e,i){st.isActive&&(this.origin&&([t,e,i]=[...this.origin,1]),this.pol=this.genPol(t,e,i,.15),rt(this.pol.vertices))}show(t,e,i=1){X.stroke&&this.draw(t,e,i),X.hatch&&this.hatch(t,e,i),X.fill&&this.fill(t,e,i),this.erase(t,e,i)}}let lt,ut,ht,ft,mt;class xt{constructor(){this.isClosed=!1,this.curvature=ht,this.vert=[]}vertex(t,e,i){this.vert.push([t,e,i])}show(){wt(this.vert,this.curvature,this.isClosed).show()}}function dt(t=0){ht=p(t,0,1),lt=[]}function gt(t,e,i=1){ut=new xt,lt.push(ut),ut.vertex(t,e,i)}function pt(t,e,i=1){ut.vertex(t,e,i)}function vt(){ut.vertex(...ut.vert[0]),ut.isClosed=!0}function yt(){for(let t of lt)t.show();lt=!1}function wt(t,e=.5,i=!1){const n=new ct(0===e?"segments":"curve"),o=2*Math.PI;if(i&&0!==e&&t.push(t[1]),t&&t.length>0){let s,r,a,c=0;for(let l=0;l<t.length-1;l++)if(e>0&&l<t.length-2){const u=t[l],h=t[l+1],f=t[l+2],m=z(u[0],u[1],h[0],h[1]),x=z(h[0],h[1],f[0],f[1]),d=T(u[0],u[1],h[0],h[1]),g=T(h[0],h[1],f[0],f[1]),p=e*Math.min(m,x,.5*Math.min(m,x)),v=Math.max(m,x),_=m-p,k=x-p;if(Math.floor(d)===Math.floor(g)){const e=i&&0===l?0:m-c,o=i?0===l?0:x-a:x;n.addSegment(d,e,u[2],!0),l===t.length-3&&n.addSegment(g,o,h[2],!0),c=0,0===l&&(s=m,a=p,r=t[1],c=0)}else{const e={x:h[0]-p*y(-d),y:h[1]-p*w(-d)},f={x:e.x+v*y(90-d),y:e.y+v*w(90-d)},m={x:h[0]+p*y(-g),y:h[1]+p*w(-g)},x=M(e,f,m,{x:m.x+v*y(90-g),y:m.y+v*w(90-g)},!0),b=z(e.x,e.y,x.x,x.y),E=z(e.x,e.y,m.x,m.y)/2,A=o*b*(2*Math.asin(E/b)*(180/Math.PI))/360,T=i&&0===l?0:_-c,R=l===t.length-3?i?s-p:k:0;n.addSegment(d,T,u[2],!0),n.addSegment(d,isNaN(A)?0:A,u[2],!0),n.addSegment(g,R,h[2],!0),c=p,0===l&&(s=_,a=p,r=[e.x,e.y])}l===t.length-3&&n.endPlot(g,h[2],!0)}else if(0===e){const e=t[l],i=t[l+1],o=z(e[0],e[1],i[0],i[1]),s=T(e[0],e[1],i[0],i[1]);n.addSegment(s,o,i[2],!0),l===t.length-2&&n.endPlot(s,1,!0)}n.origin=i&&0!==e?r:t[0]}return n}let _t,kt=0,bt=!0,Et=30;t.frameCount=0;let At=t=>(t&&(Et=t),Et);function zt(e){bt&&(e>kt+1e3/At()||0===e)&&(kt=e,t.frameCount++,_t&&_t(),Tt()),requestAnimationFrame(zt)}function Tt(){L.blend(!1,!0)}let Mt,Rt,Ft=!1;function It(){Ft||(N(),Mt=L.gl,Rt=new Float32Array([2/C,0,0,0,0,-2/S,0,0,0,0,1,0,-1,1,0,1]),function(){const t=function(t,e,i){const n=t.createProgram();for(const[o,s]of[[t.VERTEX_SHADER,e],[t.FRAGMENT_SHADER,i]]){const e=t.createShader(o);t.shaderSource(e,s),t.compileShader(e),t.attachShader(n,e)}return t.linkProgram(n),n}(Mt,Bt,Ct);Mt.useProgram(t),Mt.enable(Mt.BLEND),Mt.blendFunc(Mt.ONE_MINUS_DST_ALPHA,Mt.ONE),["a_position","a_radius","a_alpha"].forEach((e=>St[e]=Mt.getAttribLocation(t,e))),["u_matrix","u_drawSquare"].forEach((e=>Pt[e]=Mt.getUniformLocation(t,e)))}(),Ft=!0)}const Bt="#version 300 es\nin vec2 a_position;in float a_radius,a_alpha;uniform mat4 u_matrix;out float v_alpha;void main(){gl_Position=u_matrix*vec4(a_position,0,1);v_alpha=a_alpha;gl_PointSize=a_radius*2.;}",Ct="#version 300 es\nprecision highp float;uniform bool u_drawSquare;in float v_alpha;out vec4 outColor;void main(){if(u_drawSquare)outColor=vec4(vec3(1,0,0)*v_alpha,v_alpha);else{vec2 v=gl_PointCoord-vec2(.5);float e=length(v);if(e>.5)discard;outColor=vec4(vec3(1,0,0)*v_alpha,v_alpha*(1.-smoothstep(.45,.5,e)));}}",St={},Pt={};function Xt(){const t=4*Float32Array.BYTES_PER_ELEMENT,e=new Float32Array(4*Ut.length);Ut.forEach(((t,i)=>{const n=4*i;e.set([t.x,t.y,t.radius,t.alpha],n)})),Ut=[];const{vao:i,buf:n}=function(t,e,i){const n=Mt.createVertexArray();Mt.bindVertexArray(n);const o=Mt.createBuffer();return Mt.bindBuffer(Mt.ARRAY_BUFFER,o),Mt.bufferData(Mt.ARRAY_BUFFER,t,Mt.STATIC_DRAW),e.forEach((t=>{const e=St[t.name];Mt.enableVertexAttribArray(e),Mt.vertexAttribPointer(e,t.size,Mt.FLOAT,!1,i,t.offset)})),{vao:n,buf:o}}(e,[{name:"a_position",size:2,offset:0},{name:"a_radius",size:1,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"a_alpha",size:1,offset:3*Float32Array.BYTES_PER_ELEMENT}],t);Mt.uniformMatrix4fv(Pt.u_matrix,!1,Rt),Mt.uniform1i(Pt.u_drawSquare,Dt?1:0),Mt.bindVertexArray(i),Mt.drawArrays(Mt.POINTS,0,e.length/4),Mt.bindVertexArray(null),Mt.deleteBuffer(n),Mt.deleteVertexArray(i)}let Ut=[],Dt=!1;function Yt(t,e,i,n){It();const o=i/2/1.2;Ut.push({x:t+W.x,y:e+W.y,radius:o,alpha:n/100}),Dt=!0}const Nt=2*Math.PI;X.stroke={color:new Y("black"),weight:1,clipWindow:null,type:"HB",isActive:!1};let Lt,Ot,Wt,qt,Ht,Gt=new Map;function Vt(){return{...X.stroke}}function jt(t){X.stroke={...t}}function $t(t,e){e.type=["marker","custom","image","spray"].includes(e.type)?e.type:"default",Gt.set(t,{param:e,colors:[],buffers:[]})}function Jt(t){Gt.has(t)&&(X.stroke.type=t)}function Kt(t,e,i){X.stroke.color=new Y(...arguments),X.stroke.isActive=!0}function Qt(t){X.stroke.weight=t}function Zt(t,e,i=1){Jt(t),Kt(e),Qt(i)}const te={};function ee(t,e,i,n,o){Lt=new G(t,e),Ot=i,Wt=n,qt=o,qt&&qt.calcIndex(0)}const ie=[];function ne(t,e){e||(Ht=t),function(){te.seed=99999*f();const{param:t}=Gt.get(X.stroke.type)??{};if(!t)return;te.p=t;const{pressure:e}=t;te.a="custom"!==e.type?f(-1,1):0,te.b="custom"!==e.type?f(1,1.5):0,te.cp="custom"!==e.type?f(3,3.5):f(-.2,.2),[te.min,te.max]=e.min_max,It(),L.blend(X.stroke.color),L.isBrush=!0,te.alpha=ce(),he()}();const i=function(){const{param:t}=Gt.get(X.stroke.type)??{};return t?"default"===t.type||"spray"===t.type?t.spacing/X.stroke.weight:t.spacing:1}(),n=Math.round(Ot*(e?t:1)/i);for(let o=0;o<n;o++)ie.length<2*n&&ie.push(x()),oe(),e?Lt.plotTo(qt,i,i,t,o<10):Lt.moveTo(i,t,i,Wt);Xt(X.stroke.color),he()}function oe(e=!1){if(!le())return;let i=e||se();switch(i*=1-.2*t.noise(.01*Lt.plotted+te.seed,1)-.2*t.noise(.003*Lt.x,.003*Lt.y),te.p.type){case"spray":!function(t){const e=X.stroke.weight*te.p.vibration*t+X.stroke.weight*h(ie)*te.p.vibration/3,i=X.stroke.weight*f(.9,1.1),n=Math.ceil(te.p.quality/t);for(let t=0;t<n;t++){const t=f(.9,1.1),n=t*e*f(-1,1),o=f(-1,1),s=Math.sqrt((t*e)**2-n**2);Yt(Lt.x+n,Lt.y+o*s,i,te.alpha)}}(i);break;case"marker":ue(i);break;case"custom":case"image":!function(t,e,i=!0){L.ctx.save();const n=i?X.stroke.weight*te.p.vibration:0,o=i?n*f(-1,1):0,s=i?n*f(-1,1):0;L.ctx.translate(Lt.x+o,Lt.y+s),function(t){L.ctx.scale(t,t);let e=0;"random"===te.p.rotate?e=m(0,Nt):"natural"===te.p.rotate&&(e=(qt?-qt.angle(Lt.plotted):-Ht)+(Wt?Lt.angle():0),e=e*Math.PI/180),L.ctx.rotate(e)}(X.stroke.weight*t),te.p.tip(L.ctx),L.ctx.restore()}(i);break;default:!function(t){const e=X.stroke.weight*te.p.vibration*(te.p.definition+(1-te.p.definition)*h(ie)*ae(.5,.9,5,.2,1.2)/t);f(0,te.p.quality*t)>.4&&Yt(Lt.x+.7*e*f(-1,1),Lt.y+e*f(-1,1),t*te.p.weight*f(.85,1.15),te.alpha)}(i)}}function se(){return qt?re()*qt.pressure(Lt.plotted):re()}function re(){return"custom"===te.p.pressure.type?g(te.p.pressure.curve(Lt.plotted/Ot)+te.cp,0,1,te.min,te.max,!0):ae()}function ae(t=.5+te.p.pressure.curve[0]*te.a,e=1-te.p.pressure.curve[1]*te.b,i=te.cp,n=te.min,o=te.max){return g(1/(1+Math.pow(Math.abs((Lt.plotted-t*Ot)/(e*Ot/2)),2*i)),0,1,n,o)}function ce(){return["default","spray"].includes(te.p.type)?te.p.opacity:te.p.opacity/X.stroke.weight}function le(){if(X.stroke.clipWindow)return Lt.x>=X.stroke.clipWindow[0]&&Lt.x<=X.stroke.clipWindow[2]&&Lt.y>=X.stroke.clipWindow[1]&&Lt.y<=X.stroke.clipWindow[3];{let t=C,e=S,i=.05*C,n=Lt.x+W.x,o=Lt.y+W.y;return n>=-i&&n<=t+i&&o>=-i&&o<=e+i}}function ue(t,e=!0,i=te.alpha){const n=e?X.stroke.weight*te.p.vibration:0,o=e?n*f(-1,1):0,s=e?n*f(-1,1):0;!function(t,e,i,n){It();const o=i/2;Ut.push({x:t+W.x,y:e+W.y,radius:o,alpha:n/100}),Dt=!1}(Lt.x+o,Lt.y+s,X.stroke.weight*te.p.weight*t,i)}function he(){if(le()){let t=se(),e=ce();if("marker"===te.p.type){for(let i=1;i<10;i++)ue(t*i/10,!1,5*e);Xt(X.stroke.color)}else if("custom"===te.p.type||"image"===te.p.type)for(let i=1;i<5;i++)L.ctx.beginPath(),te.drawCustomOrImage(t*i/5,e,!1),L.ctx.fill()}}function fe(t,e,i,n){H();let o=z(t,e,i,n);0!=o&&(ee(t,e,o,!0,!1),ne(T(t,e,i,n),!1))}const me=["weight","vibration","definition","quality","opacity","spacing","pressure","type","tip","rotate"],xe=[["pen",[.35,.12,.5,8,88,.3,{curve:[.15,.2],min_max:[1.4,.9]}]],["rotring",[.2,.05,.5,30,115,.15,{curve:[.35,.2],min_max:[1.3,.9]}]],["2B",[.35,.6,.1,8,140,.2,{curve:[.15,.2],min_max:[1.5,1]}]],["HB",[.3,.5,.4,4,130,.25,{curve:[.15,.2],min_max:[1.2,.9]}]],["2H",[.2,.4,.3,2,60,.2,{curve:[.15,.2],min_max:[1.2,.9]}]],["cpencil",[.4,.55,.8,7,70,.15,{curve:[.15,.2],min_max:[.95,1.2]}]],["charcoal",[.35,1.5,.65,300,60,.06,{curve:[.15,.2],min_max:[1.3,.9]}]],["crayon",[.25,2,.8,300,60,.06,{curve:[.35,.2],min_max:[.9,1.1]}]],["spray",[.2,12,15,40,35,.65,{curve:[0,.1],min_max:[1,1]},"spray"]],["marker",[2.5,.12,null,null,.4,.04,{curve:[.35,.25],min_max:[1.5,1]},"marker"]]];for(let t of xe){let e={};for(let i=0;i<t[1].length;i++)e[me[i]]=t[1][i];$t(t[0],e)}function de(){return{...X.hatch}}function ge(t=5,e=45,i={rand:!1,continuous:!1,gradient:!1}){let n=X.hatch;n.isActive=!0,n.dist=t,n.angle=e,n.options=i}function pe(t){let e=X.hatch.dist,i=A(X.hatch.angle)%180,n=X.hatch.options,o=Vt();X.hatch.hBrush&&Zt(...Object.values(X.hatch.hBrush)),Array.isArray(t)||(t=[t]);const s=function(t){let e={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};for(let i of t){const t=ve(i);e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}return e}(t);let r=new at([[s.minX,s.minY],[s.maxX,s.minY],[s.maxX,s.maxY],[s.minX,s.maxY]]),a=i<=90&&i>=0?s.minY:s.maxY,c=n.gradient?g(n.gradient,0,1,1,1.1,!0):1,l=[],u=0,h=e,m=t=>({point1:{x:s.minX+h*t*y(90-i),y:a+h*t*w(90-i)},point2:{x:s.minX+h*t*y(90-i)+y(-i),y:a+h*t*w(90-i)+w(-i)}});for(;r.intersect(m(u)).length>0;){let e=[];for(let i of t)e.push(i.intersect(m(u)));l[u]=e.flat().sort(((t,e)=>t.x===e.x?t.y-e.y:t.x-e.x)),h*=c,u++}let x=l.filter((t=>void 0!==t[0])),d=n.rand||0;for(let t=0;t<x.length;t++){let i=x[t],o=t>0&&n.continuous;for(let n=0;n<i.length-1;n+=2)0!==d&&(i[n].x+=d*e*f(-10,10),i[n].y+=d*e*f(-10,10),i[n+1].x+=d*e*f(-10,10),i[n+1].y+=d*e*f(-10,10)),fe(i[n].x,i[n].y,i[n+1].x,i[n+1].y),o&&fe(x[t-1][1].x,x[t-1][1].y,i[n].x,i[n].y)}jt(o)}function ve(t){if(t._boundingBox)return t._boundingBox;let e=Infinity,i=Infinity,n=-Infinity,o=-Infinity;for(let s=0;s<t.a.length;s++){const[r,a]=t.a[s];r<e&&(e=r),r>n&&(n=r),a<i&&(i=a),a>o&&(o=a)}return t._boundingBox={minX:e,minY:i,maxX:n,maxY:o},t._boundingBox}function ye(){return{...X.fill}}function we(t,e,i,n){X.fill.opacity=(arguments.length<4?e:n)||60,X.fill.color=arguments.length<3?new Y(t):new Y(t,e,i),X.fill.isActive=!0}function _e(t,e="out"){X.fill.bleed_strength=p(t,0,1),X.fill.direction=e}function ke(t=.4,e=.4){X.fill.texture_strength=p(t,0,1),X.fill.border_strength=p(e,0,1)}let be;at.prototype.draw=function(t=!1,e,i){let n=Vt();if(t&&Zt(t,e,i),n.isActive)for(let t of this.sides)fe(t[0].x,t[0].y,t[1].x,t[1].y);jt(n)},ct.prototype.draw=function(t,e,i){Vt().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],i=1),function(t,e,i,n){H(),ee(e,i,t.length,!0,t),ne(n,!0)}(this,t,e,i))},X.hatch={isActive:!1,dist:5,angle:45,options:{},hBrush:!1},at.prototype.hatch=function(t=!1,e,i){let n=de();t&&ge(t,e,i),n.isActive&&pe(this),function(t){X.hatch={...t}}(n)},ct.prototype.hatch=function(t,e,i){de().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],i=1),this.pol=this.genPol(t,e,i,.25),this.pol.hatch())},X.fill={color:new Y("#002185"),opacity:60,bleed_strength:.07,texture_strength:.8,border_strength:.5,direction:"out",isActive:!1};const Ee=[],Ae=[];class ze{constructor(t,e,i,n,o,s,r){if(this.v=t,this.dir=n,this.m=e,this.midP=i,this.sizeX=s,this.sizeY=r,o){this.sizeX=-Infinity,this.sizeY=-Infinity;for(let t of this.v)this.sizeX=Math.max(Math.abs(this.midP.x-t.x),this.sizeX),this.sizeY=Math.max(Math.abs(this.midP.y-t.y),this.sizeY);for(let t=0;t<this.v.length;t++){const e=this.v[t],i=this.v[(t+1)%this.v.length],n={x:i.x-e.x,y:i.y-e.y},o=R(0,0,n.x,n.y,90);let s={point1:{x:e.x+n.x/2,y:e.y+n.y/2},point2:{x:e.x+n.x/2+o.x,y:e.y+n.y/2+o.y}};const r=(t,e,i)=>(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)>.01;let a=0;for(let t of be.intersect(s))r(e,i,t)&&a++;this.dir[t]=a%2==0}}}trim(t=1){let e=[...this.v],i=[...this.m],n=[...this.dir];if(this.v.length>8&&t>=0&&1!==t){const o=~~((1-t)*this.v.length),s=~~(this.v.length/2-o/2);e.splice(s,o),i.splice(s,o),n.splice(s,o)}return{v:e,m:i,dir:n}}grow(t=1){const{v:e,m:i,dir:n}=this.trim(t),o=e.length,s=2*o,r=new Array(s),a=new Array(s),c=new Array(s),l="out"===X.fill.direction?-90:90;let u=0,m=999===t?f(.2,.6):X.fill.bleed_strength/1.7;for(let s=0;s<o;s++){Ee.length<1.5*o&&(Ee.push(x(.5,.2)),Ae.push(x(0,.02)));const d=e[s],g=s+1<o?e[s+1]:e[0];t<997&&(m=et.get(d.x,d.y,i[s]));const p=(n[s]?l:-l)+5*f(-1,1),v=g.x-d.x,y=g.y-d.y,{x:w,y:_}=R(0,0,v,y,p),k=f(.35,.65),b=h(Ee)*f(.65,1.35)*m;r[u]=d,a[u]=i[s],c[u++]=n[s],r[u]={x:d.x+v*k+w*b,y:d.y+y*k+_*b},a[u]=i[s]+h(Ae),c[u++]=n[s]}return new ze(r,a,this.midP,c,!1,this.sizeX,this.sizeY)}fill(t,e,i){const n=3*i,o=e*(1+i/2);L.blend(t),L.ctx.save(),L.ctx.fillStyle="rgb(255 0 0 / "+2*o+"%)",L.ctx.strokeStyle="rgb(255 0 0 / "+.01*X.fill.border_strength+")";const s=Math.max(this.sizeX,this.sizeY);L.ctx.lineCap="round";const r=f(.15,.7);let a,c=this.grow();for(let i=0;i<24;i++){i%4==0&&(c=c.grow()),a=[c.grow(1-.0125*i),c.grow(.7-.0125*i),c.grow(.4-.0125*i)];for(let t of a)t.grow(997).grow().layer(i,s);c.grow(r).grow(999).layer(i,s),i%6!=0&&23!==i||(0!==n&&c.erase(4*n,e),L.blend(t,!0,!1,!0))}et.update(),L.ctx.restore()}layer(t,e){L.ctx.lineWidth=g(t,0,24,e/25,e/30,!0),nt(this.v),L.ctx.fill(),L.ctx.stroke()}erase(t,e){L.ctx.save();let i=f(60,80)*g(t,0,1,2,3);const n=this.sizeX/1.8,o=this.sizeY/1.8,s=Math.min(this.sizeX,this.sizeY)*(1.4-X.fill.bleed_strength),r=.05*s,a=.4*s,c=this.midP.x,l=this.midP.y;L.ctx.globalCompositeOperation="destination-out";let u=(5-g(e,80,100,.3,1,!0))*t;L.ctx.fillStyle="rgb(255 0 0 / "+u/255+")",L.ctx.lineWidth=0;for(let t=0;t<i;t++){const e=c+x(0,n),i=l+x(0,o),s=f(r,a);L.ctx.beginPath(),ot(e,i,s),t%4!=0&&L.ctx.fill()}L.ctx.globalCompositeOperation="source-over",L.ctx.restore()}}at.prototype.fill=function(t=!1,e,i,n,o,s){let r=ye();t&&(we(t,e),_e(i,s),ke(n,o)),r.isActive&&(H(),function(t){be=t;let e=[...t.vertices];const i=e.length,n=.25*i*d({1:5,2:10,3:60}),o=X.fill.bleed_strength;let s=e.map(((t,e)=>{let i=f(.85,1.2)*o;return e>n?i:.2*i}));const r=m(0,i);e=[...e.slice(r),...e.slice(0,r)];const a=function(t){const e=(t=[...t])[0],i=t[t.length-1];e.x===i.x&&e.y===i.y||t.push(e);let n=0,o=0,s=0,r=t.length;for(let i=0,a=r-1;i<r;a=i++){const r=t[i],c=t[a],l=(r.y-e.y)*(c.x-e.x)-(c.y-e.y)*(r.x-e.x);n+=l,o+=(r.x+c.x-2*e.x)*l,s+=(r.y+c.y-2*e.y)*l}const a=3*n;return{x:o/a+e.x,y:s/a+e.y}}(e);new ze(e,s,a,[],!0).fill(X.fill.color,g(X.fill.opacity,0,100,0,1,!0),X.fill.texture_strength)}(this)),function(t){X.fill={...t}}(r)},ct.prototype.fill=function(t,e,i){ye().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],i=1),this.pol=this.genPol(t,e,i,g(X.fill.bleed_strength,0,.6,.2,.45)),this.pol.fill())},t.Color=Y,t.Plot=ct,t.Polygon=at,t.Position=G,t.add=$t,t.addField=tt,t.arc=function(t,e,i,n,o){const s=new ct("curve"),r=270-A(n),a=270-A(o),c=A(o-n),l=Math.PI*i*c/180;s.addSegment(r,l,1,!0),s.endPlot(a,1,!0);const u=t+i*y(-r-90),h=e+i*w(-r-90);s.draw(u,h,1)},t.background=function(t,e,i){N(),O=new Y(...arguments),L.worker.postMessage({color:O.gl,isBG:!0})},t.beginPath=dt,t.beginStroke=function(t,e,i){mt=[e,i],ft=new ct(t)},t.box=function(){return[...Gt.keys()]},t.circle=function(t,e,i,n=!1){const o=new ct("curve"),s=Math.PI*i,r=f(0,360),a=n?()=>1+.2*f():()=>1;for(let t=0;t<4;t++){const e=-90*t+r;o.addSegment(e*a(),s/2*a(),1,!0)}if(n){const t=m(-5,5);o.addSegment(r,Math.abs(t)*(Math.PI/180)*i,1,!0),o.endPlot(t+r,1,!0)}else o.endPlot(r,1,!0);const c=t-i*w(r),l=e-i*y(-r);o.show(c,l,1)},t.clip=function(t){X.stroke.clipWindow=t},t.closePath=vt,t.draw=Tt,t.drawImage=function(t,e=0,i=0,n=t.width,o=t.height){N(),"[object ImageBitmap]"===Object.prototype.toString.call(t)&&0===e||(L.ctx.drawImage(t,e,i,n,o),t=L.mask.transferToImageBitmap()),L.blend(!1,!1,t)},t.endPath=yt,t.endStroke=function(t,e){ft.endPlot(t,e),ft.draw(mt[0],mt[1],1),ft=!1},t.erase=function(t=_bg_Color,e=255){st.isActive=!0,st.c=new Y(t),st.a=e},t.field=function(t){if(!Q.has(t))throw new Error(`Field "${name}" does not exist.`);X.field.isActive=!0,X.field.current=t},t.fillBleed=_e,t.fillStyle=we,t.fillTexture=ke,t.frameRate=At,t.hatch=ge,t.hatchArray=pe,t.hatchStyle=function(t,e="black",i=1){X.hatch.hBrush={brush:t,color:e,weight:i}},t.line=fe,t.lineTo=pt,t.lineWidth=Qt,t.listFields=function(){return Array.from(Q.keys())},t.load=function(t,e){B=t,I[B]||(I[B]={canvas:e}),C=I[B].canvas.width,S=I[B].canvas.height,P=!0,L.load()},t.loop=function(t=!1){t&&(_t=t),bt=!0,requestAnimationFrame(zt)},t.move=function(t,e,i){ft.addSegment(t,e,i)},t.moveTo=gt,t.noClip=function(){X.stroke.clipWindow=null},t.noErase=function(){st.isActive=!1},t.noField=function(){X.field.isActive=!1},t.noFill=function(){X.fill.isActive=!1},t.noHatch=function(){X.hatch.isActive=!1,X.hatch.hBrush=!1},t.noLoop=function(){bt=!1},t.noStroke=function(){X.stroke.isActive=!1},t.noiseSeed=function(e){t.noise=r(a(e))},t.pick=Jt,t.polygon=function(t){new at(t).show()},t.random=h,t.rect=function(t,e,i,n,o="corner"){"center"===o&&(t-=i/2,e-=n/2),dt(0),gt(t,e),pt(t+i,e),pt(t+i,e+n),pt(t,e+n),vt(),yt()},t.refreshField=function(t=0){Q.get(X.field.current).field=Q.get(X.field.current).gen(t,Z())},t.restore=function(){L.ctx.restore();let t=L.ctx.getTransform();W.x=t.e,W.y=t.f,X.stroke={...it.stroke},X.field={...it.field},X.hatch={...it.hatch},X.fill={...it.fill},et.restore()},t.rotate=function(t=0){H(),L.ctx.rotate(t)},t.save=function(){H(),L.ctx.save(),it.fill={...X.fill},it.stroke={...X.stroke},it.hatch={...X.hatch},it.field={...X.field},et.save()},t.scale=function(t){H(),L.ctx.scale(t,t)},t.scaleBrushes=function(t){for(const{param:e}of Gt.values())e&&(e.weight*=t,e.vibration*=t,e.spacing*=t)},t.seed=function(t){l=a(t)},t.set=Zt,t.spline=function(t,e=.5){wt(t,e).draw()},t.stroke=function(t,e,i,n){H(),ee(t,e,i,!0,!1),ne(A(n),!1)},t.strokeStyle=Kt,t.translate=function(t,e){H(),L.ctx.translate(t,e);let i=L.ctx.getTransform();W.x=i.e,W.y=i.f},t.wRand=d},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).brush={});
